<!-- =========================
  PART 1 / 2
  (ì—¬ê¸°ë¶€í„° ë³µì‚¬)
========================= -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>BÂ·PASS Living</title>

  <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Toss Payment Widget -->
  <script src="https://js.tosspayments.com/v1/payment-widget"></script>

  <style>
    :root{
      --bg:#F8F9FE;
      --primary:#2563EB;
      --primary2:#4F46E5;
      --accent:#CCF802;
      --text:#111827;
      --sub:#6B7280;
      --card:rgba(255,255,255,0.78);
      --card2:rgba(255,255,255,0.92);
      --border:rgba(255,255,255,0.65);
      --shadow:0 10px 40px -10px rgba(37,99,235,0.15);
      --shadow2:0 20px 50px -12px rgba(37,99,235,0.22);
      --safeB: env(safe-area-inset-bottom);
      --radius:28px;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Pretendard",sans-serif;-webkit-tap-highlight-color:transparent;}
    body{background:var(--bg);color:var(--text);overflow:hidden;}

    /* ìƒì„¸ ë²„íŠ¼ ê°€ë¡œ ê³ ì • */
    .pill{
      white-space: nowrap;
      flex-direction: row;
    }

    /* í¬í•¨ ì„œë¹„ìŠ¤ ë°˜ì‘í˜• ì •ë¦¬ */
    @media (max-width: 900px){
      .benefits{ grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 520px){
      .benefits{ grid-template-columns: repeat(2, 1fr); }
    }

    /* background */
    .aurora{
      position:fixed;inset:0;z-index:-3;
      background:
        radial-gradient(at 0% 0%, rgba(96,165,250,0.22) 0, transparent 55%),
        radial-gradient(at 100% 20%, rgba(204,248,2,0.16) 0, transparent 55%),
        radial-gradient(at 70% 100%, rgba(79,70,229,0.14) 0, transparent 60%);
      animation:breathe 6s ease-in-out infinite alternate;
    }
    @keyframes breathe{from{opacity:.82;transform:scale(1)}to{opacity:1;transform:scale(1.05)}}

    /* phone frame */
    .app{max-width:500px;height:100dvh;margin:0 auto;display:flex;flex-direction:column;position:relative;}

    /* header bg bar */
    .header-bg{
      position:fixed;top:0;left:0;right:0;height:96px;
      z-index:40;pointer-events:none;
      background:linear-gradient(180deg, rgba(37,99,235,.14) 0%, rgba(248,249,254,0) 100%);
    }

    /* header fixed */
    header{
      position:fixed;top:0;left:0;right:0;z-index:50;
      padding:18px 24px;
      display:flex;align-items:center;justify-content:space-between;
      background:transparent;
    }
    .logo{
      font-size:26px;font-weight:950;letter-spacing:-0.6px;
      background:linear-gradient(90deg,var(--primary),var(--primary2));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      filter:drop-shadow(0 2px 4px rgba(37,99,235,.22));
      display:flex;align-items:center;gap:10px;
    }
    .guest-badge{
      font-size:11px;font-weight:900;color:#111;
      background:rgba(255,255,255,.7);
      padding:5px 10px;border-radius:999px;
      border:1px solid rgba(0,0,0,.06);
    }
    .lang-btn{
      background:rgba(255,255,255,.88);
      border:1px solid rgba(255,255,255,.7);
      padding:8px 14px;border-radius:18px;font-size:13px;font-weight:900;
      box-shadow:0 4px 12px rgba(0,0,0,.06);
      display:flex;gap:6px;align-items:center;cursor:pointer;
      backdrop-filter: blur(8px);
    }

    /* views */
    .view{flex:1;overflow-y:auto;padding:84px 24px calc(120px + var(--safeB));display:none;scroll-behavior:smooth;}
    .view.active{display:block;animation:fade .35s cubic-bezier(.2,.8,.2,1);}
    @keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    /* cards */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(18px);
      margin-bottom:16px;
    }
    .card:active{transform:scale(.985)}
    .card-title{font-size:18px;font-weight:950;letter-spacing:-.4px;margin-bottom:10px;}
    .muted{color:var(--sub);font-weight:700;}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px;}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      background:rgba(17,24,39,.06);
      border:1px solid rgba(17,24,39,.06);
      padding:9px 12px;border-radius:16px;
      font-weight:900;font-size:13px;color:var(--text);
      cursor:pointer;
    }
    .pill.primary{
      background:var(--primary);
      color:#fff;border-color:rgba(255,255,255,.12);
      box-shadow:0 10px 22px rgba(37,99,235,.22);
    }
    .pill.primary:active{transform:scale(.98)}
    .pill.ghost{
      background:rgba(255,255,255,.88);
      border:1px solid rgba(255,255,255,.7);
      backdrop-filter: blur(10px);
    }

    /* wallet */
    .wallet{
      background:linear-gradient(135deg,#2563EB 0%, #1D4ED8 100%);
      color:#fff; border:none; box-shadow:var(--shadow2);
      position:relative; overflow:hidden;
    }
    .wallet::before{
      content:"";position:absolute;inset:-60%;
      background: radial-gradient(circle, rgba(255,255,255,.22) 0%, transparent 58%);
      animation:shine 4s linear infinite;
    }
    @keyframes shine{to{transform:rotate(360deg)}}
    .wallet-inner{position:relative;z-index:2}
    .balance-label{font-size:13px;font-weight:800;opacity:.92;margin-bottom:6px;}
    .balance{font-size:30px;font-weight:950;letter-spacing:-.8px;margin-bottom:16px;}
    .wallet-actions{display:flex;gap:10px;flex-wrap:wrap}

    /* quick menu */
    .menu-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:8px 0 18px;}
    .menu-item{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;}
    .icon-box{
      width:56px;height:56px;border-radius:22px;background:#fff;
      border:1px solid rgba(255,255,255,.8);
      box-shadow:var(--shadow);
      display:flex;align-items:center;justify-content:center;color:var(--primary);
      transition:.2s;
    }
    .menu-item:active .icon-box{transform:scale(.92) translateY(2px)}
    .menu-label{font-size:13px;font-weight:900;color:var(--sub)}

    /* how-to 3 steps */
    .steps{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px;}
    .step{
      background:rgba(255,255,255,.86);
      border:1px solid rgba(255,255,255,.72);
      border-radius:18px;padding:12px 12px;
      box-shadow:0 10px 22px rgba(0,0,0,.04);
    }
    .step-num{font-size:11px;font-weight:950;color:var(--primary);margin-bottom:6px;}
    .step-t{font-weight:950;font-size:13px;letter-spacing:-.2px;margin-bottom:4px;}
    .step-d{font-size:12px;color:var(--sub);font-weight:800;line-height:1.2;}

    /* benefit icons */
    .benefits{
      display:grid;grid-template-columns:repeat(4,1fr);
      gap:10px;margin-top:12px;
    }
    .benefit{
      background:rgba(255,255,255,.86);
      border:1px solid rgba(255,255,255,.72);
      border-radius:18px;padding:12px;
      display:flex;flex-direction:column;gap:8px;align-items:flex-start;
    }
    .benefit .b-ic{width:34px;height:34px;border-radius:12px;background:rgba(37,99,235,.1);color:var(--primary);display:flex;align-items:center;justify-content:center;}
    .benefit .b-t{font-size:12px;font-weight:950;letter-spacing:-.2px;}
    .benefit .b-d{font-size:11px;color:var(--sub);font-weight:800;line-height:1.2;}

    /* partner carousel */
    .carousel{display:flex;gap:12px;overflow-x:auto;padding-bottom:6px;scroll-snap-type:x mandatory;}
    .carousel::-webkit-scrollbar{display:none}
    .partner{
      min-width:220px;scroll-snap-align:start;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(255,255,255,.75);
      border-radius:22px;padding:16px;
      box-shadow:0 14px 28px rgba(0,0,0,.06);
    }
    .partner-cat{font-size:11px;font-weight:950;color:var(--primary);margin-bottom:6px;}
    .partner-name{font-size:16px;font-weight:950;letter-spacing:-.3px;margin-bottom:6px;}
    .partner-benefit{font-size:12px;color:var(--sub);font-weight:900;line-height:1.2;margin-bottom:10px;}
    .partner-actions{display:flex;gap:10px;flex-wrap:wrap}

    /* pass card */
    .tag{
      display:inline-block;background:var(--text);color:var(--accent);
      font-size:11px;font-weight:950;padding:5px 10px;border-radius:10px;margin-bottom:8px;
    }
    .pass-card{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;}
    .pass-right{min-width:150px;display:flex;flex-direction:column;align-items:flex-end;gap:10px;}
    .price-old{font-size:12px;font-weight:950;color:var(--sub);text-decoration:line-through;}
    .price-new{font-size:22px;font-weight:950;color:var(--primary);letter-spacing:-.4px;}
    .buy-btn{
      width:132px;text-align:center;
      padding:12px 18px;border-radius:16px;
      background:var(--primary);color:#fff;border:none;
      font-size:15px;font-weight:950;
      box-shadow:0 14px 24px rgba(37,99,235,.26);
      cursor:pointer;
    }
    .buy-btn:active{transform:scale(.98)}

    /* map view */
    #view-map{padding:0;position:relative;height:100%;}
    #map{width:100%;height:100%;z-index:1;}

    /* ============================
       âœ… ë‚´ ì£¼ë³€ ë²„íŠ¼ ì˜ë¦¼ í•´ê²° + ê²€ìƒ‰ë°” ê²¹ì¹¨ ë°©ì§€
    ============================ */
    .map-top{
      position:absolute;
      left:12px;
      right:12px;
      top:58px;
      z-index:1200;

      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:10px;

      pointer-events:none;

      padding:10px 10px;
      border-radius:20px;

      background:rgba(248,249,254,.92);
      border:1px solid rgba(255,255,255,.85);
      box-shadow:0 14px 30px rgba(0,0,0,.12);
      backdrop-filter:blur(12px);

      overflow:visible;
    }
    .map-top > *{pointer-events:auto;}

    .map-search-btn{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.7);
      border-radius:16px;
      padding:10px 12px;
      font-weight:950;
      display:flex;align-items:center;gap:8px;
      box-shadow:0 10px 24px rgba(0,0,0,.12);
      cursor:pointer;
      backdrop-filter: blur(10px);
      flex:0 0 auto;
      white-space:nowrap;
    }

    .map-search-bar{
      flex:1 1 220px;
      min-width:0;
      display:none;align-items:center;gap:10px;position: relative;
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.7);
      border-radius:18px;
      padding:10px 12px;
      box-shadow:0 10px 24px rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
    }
    .map-search-bar.open{display:flex;}
    .map-search-input{
      flex:1;border:none;outline:none;background:transparent;min-width: 0;
      font-weight:950;font-size:14px;color:var(--text);
    }
    .map-search-go{
      border:none;border-radius:14px;padding:10px 12px;
      background:var(--text);color:#fff;font-weight:950;cursor:pointer;
      white-space:nowrap;
    }
    .map-search-close{
      border:none;border-radius:14px;padding:10px 12px;
      background:rgba(0,0,0,.06);font-weight:950;cursor:pointer;
      white-space:nowrap;
    }

    .map-tools{
      display:flex;
      gap:10px;
      flex:0 0 auto;
      margin-left:auto;
    }

    .near-btn{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.7);
      border-radius:16px;
      padding:10px 12px;
      font-weight:950;
      display:flex;align-items:center;gap:8px;
      box-shadow:0 10px 24px rgba(0,0,0,.12);
      cursor:pointer;
      backdrop-filter: blur(10px);
      white-space:nowrap;
      flex:0 0 auto;
    }

    @media (max-width: 380px){
      .near-btn{ padding:10px 10px; gap:0; font-size:0; }
      .near-btn i{ width:16px; height:16px; }
    }

    .map-filters{
      position:absolute;left:12px;right:12px;top:132px;z-index:1200;
      display:flex;gap:8px;overflow-x:auto;padding-bottom:6px;
      pointer-events:auto;

      padding-top:10px;
      border-top:1px solid rgba(17,24,39,.10);
    }
    .map-filters::-webkit-scrollbar{display:none;}
    .chip{
      background:rgba(255,255,255,.9);
      border:1px solid rgba(255,255,255,.75);
      padding:10px 14px;border-radius:999px;
      font-size:13px;font-weight:950;color:var(--sub);
      box-shadow:0 10px 18px rgba(0,0,0,.06);
      white-space:nowrap;cursor:pointer;transition:.15s;
    }
    .chip.active{background:var(--primary);color:#fff;transform:scale(1.03);}

    .map-search-open .map-filters{
      top:176px !important;
    }

    /* bottom sheet */
    .sheet-overlay{
      position:fixed;inset:0;z-index:16000;
      background:rgba(0,0,0,.38);
      display:none;align-items:flex-end;justify-content:center;
      backdrop-filter: blur(6px);
    }
    .sheet{
      width:100%;max-width:500px;
      background:rgba(255,255,255,.95);
      border-radius:30px 30px 0 0;
      border:1px solid rgba(255,255,255,.7);
      padding:18px 18px calc(22px + var(--safeB));
      animation:up .28s cubic-bezier(.16,1,.3,1);
    }
    @keyframes up{from{transform:translateY(100%)}to{transform:translateY(0)}}
    .grab{width:46px;height:5px;border-radius:999px;background:rgba(17,24,39,.12);margin:0 auto 12px;}
    .place-head{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px;}
    .place-name{font-size:18px;font-weight:950;letter-spacing:-.3px;}
    .place-meta{font-size:12px;color:var(--sub);font-weight:900;line-height:1.2;}
    .benefit-badge{
      display:inline-flex;gap:6px;align-items:center;
      background:rgba(37,99,235,.1);color:var(--primary);
      padding:7px 10px;border-radius:12px;font-weight:950;font-size:12px;
      border:1px solid rgba(37,99,235,.15);
      margin-top:8px;
    }
    .sheet-actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap;}
    .sheet-actions .pill{flex:1;justify-content:center;}

    /* MY page */
    .tabs{display:flex;gap:10px;margin:8px 0 14px;}
    .tab{
      flex:1;text-align:center;
      padding:10px 12px;border-radius:16px;
      background:rgba(255,255,255,.86);
      border:1px solid rgba(255,255,255,.75);
      font-weight:950;color:var(--sub);
      cursor:pointer;
    }
    .tab.active{background:var(--primary);color:#fff;border-color:rgba(255,255,255,.15);}

    .pass-big{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.75);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:0 16px 28px rgba(0,0,0,.06);
    }
    .pass-status{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;font-weight:950;font-size:12px;
      border:1px solid rgba(0,0,0,.06);
      background:rgba(17,24,39,.06);color:var(--text);
      margin-bottom:12px;
    }
    .dot{width:8px;height:8px;border-radius:50%;}
    .dot.active{background:#10B981;}
    .dot.inactive{background:#FF3B30;}
    .pass-metrics{display:flex;gap:10px;margin-top:12px;}
    .metric{flex:1;background:rgba(17,24,39,.04);border:1px solid rgba(17,24,39,.06);border-radius:18px;padding:12px;}
    .metric .k{font-size:11px;font-weight:950;color:var(--sub);margin-bottom:6px;}
    .metric .v{font-size:14px;font-weight:950;letter-spacing:-.2px;}

    .list-group{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.75);
      border-radius:22px;overflow:hidden;
      box-shadow:0 14px 26px rgba(0,0,0,.06);
    }
    .list-row{
      padding:16px 18px;display:flex;align-items:center;justify-content:space-between;
      border-bottom:1px solid rgba(17,24,39,.06);
      cursor:pointer;font-weight:950;
    }
    .list-row:last-child{border-bottom:none;}
    .list-row:active{background:rgba(17,24,39,.03);}

    /* nav dock */
    .nav-container{position:fixed;left:0;right:0;bottom:30px;z-index:9999;display:flex;justify-content:center;pointer-events:none;}
    .nav-dock{
      pointer-events:auto;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(255,255,255,.7);
      backdrop-filter: blur(18px);
      padding:12px 28px;border-radius:999px;
      box-shadow:0 16px 40px rgba(0,0,0,.14);
      display:flex;gap:28px;align-items:center; /* [ìˆ˜ì •] ì•„ì´ì½˜ 1ê°œ ì¶”ê°€ë¡œ gapë§Œ ì‚´ì§ ì¡°ì • */
    }
    .nav-item{color:#C0C0C0;cursor:pointer;transition:.2s;position:relative;}
    .nav-item.active{color:var(--primary);transform:translateY(-2px);}
    .nav-item.active::after{
      content:"";position:absolute;left:50%;transform:translateX(-50%);
      bottom:-8px;width:4px;height:4px;border-radius:50%;background:var(--primary);
    }
    .qr-btn{
      width:52px;height:52px;border-radius:50%;
      background:var(--primary);color:#fff;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 10px 28px rgba(37,99,235,.38);
      margin-top:-20px;
      border:4px solid var(--bg);
      cursor:pointer;
    }
    .qr-btn:active{transform:scale(.95)}

    /* overlays */
    .overlay{
      position:fixed;inset:0;z-index:20000;
      background:rgba(0,0,0,.45);
      display:none;align-items:flex-end;justify-content:center;
      backdrop-filter: blur(6px);
    }
    .modal{
      width:100%;max-width:500px;
      background:#fff;border-radius:32px 32px 0 0;
      padding:22px 18px calc(22px + var(--safeB));
      animation:up .28s cubic-bezier(.16,1,.3,1);
    }
    .modal h2{font-size:22px;font-weight:950;letter-spacing:-.4px;margin-bottom:10px;}
    .modal p{color:var(--sub);font-weight:800;line-height:1.35;}

    .btn-main{
      width:100%;
      padding:16px;border-radius:18px;border:none;
      background:var(--text);color:#fff;
      font-size:16px;font-weight:950;cursor:pointer;
      margin-top:12px;
      box-shadow:0 8px 18px rgba(0,0,0,.12);
    }
    .btn-sub{
      width:100%;
      padding:14px;border-radius:18px;border:1px solid rgba(17,24,39,.08);
      background:#F2F2F7;color:var(--text);
      font-size:15px;font-weight:950;cursor:pointer;
      margin-top:10px;
    }

    /* onboarding */
    .onb{
      position:fixed;inset:0;z-index:25000;
      display:none;align-items:center;justify-content:center;
      background:rgba(248,249,254,.96);
    }
    .onb-card{
      width:100%;max-width:500px;height:100%;
      padding:26px 22px calc(26px + var(--safeB));
      display:flex;flex-direction:column;
    }
    .onb-top{display:flex;justify-content:space-between;align-items:center;margin-top:8px;}
    .skip{font-weight:950;color:var(--sub);cursor:pointer;}
    .onb-slide{flex:1;display:none;flex-direction:column;justify-content:center;}
    .onb-slide.active{display:flex;}
    .onb-h{
      font-size:26px;font-weight:980;letter-spacing:-.8px;margin-bottom:12px;
      background:linear-gradient(90deg,var(--primary),var(--primary2));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    .onb-desc{color:var(--sub);font-weight:850;line-height:1.5;font-size:15px;}
    .dots{display:flex;gap:8px;justify-content:center;margin:18px 0;}
    .dot2{width:8px;height:8px;border-radius:50%;background:rgba(17,24,39,.18);}
    .dot2.active{background:var(--primary);}
    .onb-actions{display:flex;gap:10px;}
    .onb-actions .pill{flex:1;justify-content:center;}

    /* Leaflet controls */
    .leaflet-control-container{z-index:1200;}
    .leaflet-control{pointer-events:auto;}
    .leaflet-top.leaflet-left .leaflet-control-zoom{display:none!important;}

    /* ==========================================================
       âœ… QR íƒ­: 'ë°œê¸‰ì„œ(íšŒì›ì¦)' UI
    ========================================================== */
    .cert-wrap{
      position:relative;
      margin-top:8px;
      border-radius:28px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.7);
      box-shadow:0 18px 40px rgba(0,0,0,.10);
      background:linear-gradient(135deg, rgba(37,99,235,.96) 0%, rgba(79,70,229,.96) 55%, rgba(29,78,216,.96) 100%);
    }
    .cert-wrap::before{
      content:"";
      position:absolute;inset:-60%;
      background:
        radial-gradient(circle at 30% 30%, rgba(204,248,2,.28) 0%, transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(255,255,255,.18) 0%, transparent 58%);
      transform:rotate(12deg);
      animation:certShine 5.5s linear infinite;
      pointer-events:none;
    }
    @keyframes certShine{to{transform:rotate(372deg)}}
    .cert{
      position:relative;z-index:2;
      padding:18px 18px 16px;
      color:#fff;
    }
    .cert-top{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
      margin-bottom:12px;
    }
    .cert-brand{display:flex;flex-direction:column;gap:6px;}
    .cert-brand .b1{
      font-weight:980;letter-spacing:-.6px;font-size:20px;
      display:flex;align-items:center;gap:10px;
    }
    .cert-chip{
      display:inline-flex;align-items:center;gap:8px;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.22);
      padding:7px 10px;border-radius:999px;
      font-weight:950;font-size:12px;
      width:max-content;
    }
    .cert-chip .mini-dot{
      width:8px;height:8px;border-radius:50%;
      background:#FF3B30;
      box-shadow:0 0 0 4px rgba(255,59,48,.18);
    }
    .cert-chip.active .mini-dot{
      background:#10B981;
      box-shadow:0 0 0 4px rgba(16,185,129,.18);
    }
    .cert-qr{
      width:84px;height:84px;
      border-radius:18px;
      background:rgba(255,255,255,.95);
      padding:8px;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 10px 26px rgba(0,0,0,.16);
      flex:0 0 auto;
    }
    .cert-qr img{width:100%;height:100%;border-radius:12px;}
    .cert-mid{display:flex;flex-direction:column;gap:10px;}
    .cert-name{
      font-size:22px;font-weight:980;letter-spacing:-.6px;
      line-height:1.15;
    }
    .cert-sub{
      font-size:13px;font-weight:850;opacity:.92;
      line-height:1.4;
    }
    .cert-grid{
      margin-top:10px;
      display:grid;grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .cert-field{
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      border-radius:18px;
      padding:10px 12px;
    }
    .cert-field .k{
      font-size:11px;font-weight:950;opacity:.92;margin-bottom:6px;
    }
    .cert-field .v{
      font-size:13px;font-weight:980;letter-spacing:-.2px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .cert-bar{
      margin-top:14px;
      height:40px;
      border-radius:14px;
      background:
        repeating-linear-gradient(90deg, rgba(0,0,0,.75) 0, rgba(0,0,0,.75) 2px, rgba(255,255,255,.0) 2px, rgba(255,255,255,.0) 4px);
      opacity:.85;
    }
    .cert-foot{
      margin-top:12px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      flex-wrap:wrap;
    }
    .cert-foot .mini{
      font-size:12px;font-weight:900;opacity:.92;
    }
    .cert-foot .pill{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.7);
      color:var(--text);
    }

        /* ==========================================================
      [ì¶”ê°€] âœ… ëª¨ë‹¬ í¬ê¸°/ìŠ¤í¬ë¡¤/ë‹«ê¸° ê°œì„ 
      - êµ¬ë§¤í•˜ê¸°(passDetail/payment) / ì¶”ì²œ(recommend) ëª¨ë‹¬ì´ í™”ë©´ì— ë§ê²Œ ìŠ¤í¬ë¡¤
      - ë‹«ê¸° ë²„íŠ¼ì´ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë„ ìŠ¤í¬ë¡¤ë¡œ ì ‘ê·¼ ê°€ëŠ¥
    ========================================================== */

    /* ëª¨ë“  overlay ëª¨ë‹¬ ê³µí†µ: í™”ë©´ ë†’ì´ ì•ˆì—ì„œ ìŠ¤í¬ë¡¤ ë˜ê²Œ */
    .modal{
      max-height: calc(100dvh - 40px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* (ì„ íƒ) ëª¨ë‹¬ ë‚´ë¶€ ìƒë‹¨ì´ ë„ˆë¬´ ë¶™ìœ¼ë©´ ì•½ê°„ ì—¬ìœ  */
    .modal .grab{ position: sticky; top: 0; background: transparent; }

    /* (ì„ íƒ) ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ê°€ ê¸¸ì–´ì§ˆ ë•Œ ìì—°ìŠ¤ëŸ½ê²Œ ìŠ¤í¬ë¡¤ */
    #recommendModal .modal{
      max-height: calc(100dvh - 40px);
      overflow-y: auto;
    }

    /* (ì„ íƒ) ê²°ì œ ëª¨ë‹¬ë„ ë™ì¼ */
    #paymentSheet .modal{
      max-height: calc(100dvh - 40px);
      overflow-y: auto;
    }

    /* (ì„ íƒ) íŒ¨ìŠ¤ ìƒì„¸ ëª¨ë‹¬ë„ ë™ì¼ */
    #passDetailModal .modal{
      max-height: calc(100dvh - 40px);
      overflow-y: auto;
    }


    /* ==========================================================
       âœ… ì¶”ì²œ ëª¨ë‹¬ ë¦¬ìŠ¤íŠ¸ UI
    ========================================================== */
    .rec-list{display:flex;flex-direction:column;gap:10px;margin-top:12px;}
    .rec-item{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.75);
      border-radius:22px;
      padding:14px 14px;
      box-shadow:0 14px 26px rgba(0,0,0,.06);
      display:flex;flex-direction:column;gap:8px;
    }
    .rec-title{font-size:15px;font-weight:980;letter-spacing:-.3px;}
    .rec-meta{font-size:12px;color:var(--sub);font-weight:900;line-height:1.35;}
    .rec-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:2px;}
  </style>
</head>

<body>
  <div class="aurora"></div>
  <div class="header-bg"></div>

  <div class="app">
    <header>
      <div class="logo">
        <span>BÂ·PASS</span>
        <span id="guestBadge" class="guest-badge" style="display:none;">GUEST</span>
      </div>
      <div class="lang-btn" onclick="openLang()">
        <i data-feather="globe" style="width:14px;"></i>
        <span id="langText">KR</span>
      </div>
    </header>

    <!-- =========================
         HOME
    ========================== -->
    <div id="view-home" class="view active">

      <div class="card">
        <div class="row" style="align-items:flex-start;">
          <div>
            <div class="card-title">MICE ì²´ë¥˜ë¥¼ â€œíŒ¨ìŠ¤ í•˜ë‚˜ë¡œâ€</div>
            <div class="muted" style="line-height:1.35;">
              êµí†µ Â· ì›Œí¬ìŠ¤í˜ì´ìŠ¤ Â· í—¬ìŠ¤ Â· ì¹´í˜ í• ì¸ Â· ê¸´ê¸‰ì§€ì›ê¹Œì§€<br>
              <b style="color:var(--text);">ì—…ë¬´Â·ì´ë™Â·íœ´ì‹ì„ í•˜ë‚˜ë¡œ ë¬¶ì€ ì²´ë¥˜ íŒ¨ìŠ¤</b>
            </div>
          </div>
          <div class="pill ghost" onclick="openPassDetail(); event.stopPropagation();">
            <i data-feather="info" style="width:16px;"></i> ìƒì„¸
          </div>
        </div>

        <div class="steps">
          <div class="step">
            <div class="step-num">STEP 1</div>
            <div class="step-t">ë¡œê·¸ì¸</div>
            <div class="step-d">ì¹´ì¹´ì˜¤ë¡œ 3ì´ˆ ì‹œì‘</div>
          </div>
          <div class="step">
            <div class="step-num">STEP 2</div>
            <div class="step-t">êµ¬ë§¤</div>
            <div class="step-d">íŒ¨ìŠ¤ ê²°ì œ í›„ í™œì„±í™”</div>
          </div>
          <div class="step">
            <div class="step-num">STEP 3</div>
            <div class="step-t">ì´ìš©</div>
            <div class="step-d">QR ì œì‹œ í›„ í˜œíƒ ì ìš©</div>
          </div>
        </div>
      </div>

      <div class="card wallet" onclick="openQR()">
        <div class="wallet-inner">
          <div class="balance-label">ë‚´ íŒ¨ìŠ¤ ìƒíƒœ</div>
          <div id="balance" class="balance">ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”</div>

          <div class="wallet-actions" id="walletActions" style="display:none;">
            <div class="pill ghost" onclick="openMyPass(); event.stopPropagation();">
              <i data-feather="credit-card" style="width:14px;"></i> ë‚´ íŒ¨ìŠ¤
            </div>
            <div class="pill ghost" onclick="switchTab('map'); event.stopPropagation();">
              <i data-feather="map" style="width:14px;"></i> ì œíœ´ì²˜ ì°¾ê¸°
            </div>
            <div class="pill ghost" onclick="openSupport(); event.stopPropagation();">
              <i data-feather="help-circle" style="width:14px;"></i> ê³ ê°ì„¼í„°
            </div>
          </div>
        </div>
      </div>

      <div class="menu-grid">
        <div class="menu-item" onclick="filterMapAndGo('transport')">
          <div class="icon-box"><i data-feather="navigation"></i></div>
          <span class="menu-label">êµí†µ</span>
        </div>
        <div class="menu-item" onclick="filterMapAndGo('office')">
          <div class="icon-box"><i data-feather="briefcase"></i></div>
          <span class="menu-label">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</span>
        </div>
        <div class="menu-item" onclick="filterMapAndGo('gym')">
          <div class="icon-box"><i data-feather="activity"></i></div>
          <span class="menu-label">í—¬ìŠ¤</span>
        </div>
        <div class="menu-item" onclick="filterMapAndGo('food')">
          <div class="icon-box"><i data-feather="coffee"></i></div>
          <span class="menu-label">ì¹´í˜</span>
        </div>
      </div>

      <div class="card">
        <div class="card-title">í¬í•¨ ì„œë¹„ìŠ¤</div>
        <div class="muted">ì²´ë¥˜ ì¤‘ í•„ìš”í•œ í•µì‹¬ ì„œë¹„ìŠ¤ë¥¼ í•œ ë²ˆì—</div>

        <div class="benefits">
          <div class="benefit">
            <div class="b-ic"><i data-feather="coffee" style="width:18px;"></i></div>
            <div class="b-t">ì¹´í˜</div>
            <div class="b-d">íŒ¨ìŠ¤ í• ì¸</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="activity" style="width:18px;"></i></div>
            <div class="b-t">í—¬ìŠ¤</div>
            <div class="b-d">ì œíœ´ ì‹œì„¤</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="briefcase" style="width:18px;"></i></div>
            <div class="b-t">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</div>
            <div class="b-d">ë¼ìš´ì§€/ì˜¤í”¼ìŠ¤</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="phone-call" style="width:18px;"></i></div>
            <div class="b-t">ê¸´ê¸‰ì§€ì›</div>
            <div class="b-d">ë²ˆì—­/ë¶„ì‹¤/ì½œíƒì‹œ</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="file-text" style="width:18px;"></i></div>
            <div class="b-t">ì´ìš©ë‚´ì—­</div>
            <div class="b-d">íšŒì‚¬ ì œì¶œìš©</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="gift" style="width:18px;"></i></div>
            <div class="b-t">ì¿ í°/ë°”ìš°ì²˜</div>
            <div class="b-d">ë²ˆí˜¸/ì‚¬ìš©ì—¬ë¶€</div>
          </div>
        </div>
      </div>



      <!-- ==========================================================
           [ìš”ì²­ ë°˜ì˜] âœ… HOMEì— ìˆë˜ ì¶”ì²œ ì¹´ë“œ ì˜ì—­ì€ "ì£¼ì„ì²˜ë¦¬"ë¡œ ë³´ê´€
           - ì´ì œ ì¶”ì²œì€ í•˜ë‹¨ ë„¤ë¹„(â­) ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ëª¨ë‹¬ì—ì„œ ì„ íƒí•˜ëŠ” ë°©ì‹
      ========================================================== -->
      <!--
      <div class="card" id="recommendCard">
        (ê¸°ì¡´ ì¶”ì²œ ì¹´ë“œ ë‚´ìš©)
      </div>
      -->

      <div class="card pass-card" onclick="openPassDetail()">
        <div>
          <span class="tag">EARLY BIRD</span>
          <div style="font-size:17px;font-weight:980;letter-spacing:-.3px;margin-bottom:4px;">Living Week (7ì¼)</div>
          <div class="muted">MICE ì°¸ê°€ì ì „ìš© ì˜¬ì¸ì› ì²´ë¥˜í˜• íŒ¨ìŠ¤</div>
          <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
            <div class="pill ghost" onclick="openSupport(); event.stopPropagation();">
              <i data-feather="shield" style="width:14px;"></i> ê²°ì œì•ˆì‹¬
            </div>
            <div class="pill ghost" onclick="openLegal('refund'); event.stopPropagation();">
              <i data-feather="rotate-ccw" style="width:14px;"></i> í™˜ë¶ˆê·œì •
            </div>
          </div>
        </div>

        <div class="pass-right">
          <div style="text-align:right;line-height:1.1;">
            <div class="price-old">129,000ì›</div>
            <div class="price-new">99,000ì›</div>
          </div>
          <button class="buy-btn" onclick="openPassDetail(); event.stopPropagation();">êµ¬ë§¤í•˜ê¸°</button>
        </div>
      </div>

      <div class="card" style="padding:18px;">
        <div class="row" style="flex-wrap:wrap;">
          <div class="pill ghost" onclick="openLegal('terms')"><i data-feather="file" style="width:14px;"></i> ì´ìš©ì•½ê´€</div>
          <div class="pill ghost" onclick="openLegal('privacy')"><i data-feather="lock" style="width:14px;"></i> ê°œì¸ì •ë³´</div>
          <div class="pill ghost" onclick="openLegal('refund')"><i data-feather="refresh-ccw" style="width:14px;"></i> í™˜ë¶ˆ/ì·¨ì†Œ</div>
          <div class="pill ghost" onclick="openSupport()"><i data-feather="message-circle" style="width:14px;"></i> ë¬¸ì˜</div>
        </div>
        <div class="muted" style="margin-top:12px;font-size:12px;">
          * ë³¸ í™”ë©´ì€ ì‹œì—°/í”„ë¡œí† íƒ€ì… ëª©ì ì˜ UIì´ë©°, ì‹¤ì œ ì œíœ´/ìš´ì˜ ì •ë³´ëŠ” ì¶”í›„ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <!-- =========================
         MAP
    ========================== -->
    <div id="view-map" class="view">
      <div id="map"></div>

      <div class="map-top">
        <div class="map-search-btn" onclick="toggleMapSearch(true)">
          <i data-feather="search" style="width:16px;"></i> ê²€ìƒ‰
        </div>

        <div id="mapSearchBar" class="map-search-bar">
          <input id="mapSearchInput" class="map-search-input" placeholder="ì œíœ´ì²˜/ì¥ì†Œ ê²€ìƒ‰" />
          <button class="map-search-go" onclick="runMapSearch()">ê²€ìƒ‰</button>
          <button class="map-search-close" onclick="toggleMapSearch(false)">ë‹«ê¸°</button>
        </div>

        <div class="map-tools">
          <div class="near-btn" onclick="goNearMe()">
            <i data-feather="crosshair" style="width:16px;"></i> ë‚´ ì£¼ë³€
          </div>
        </div>
      </div>

      <div class="map-filters" id="mapFilters"></div>
    </div>

    <!-- =========================
         MY
    ========================== -->
    <div id="view-my" class="view">
      <div class="card" style="text-align:center;">
        <img id="profileImg" src=""
             style="width:84px;height:84px;border-radius:50%;background:#e0e0e0;box-shadow:0 4px 15px rgba(0,0,0,.1);margin-bottom:10px;">
        <div id="profileName" style="font-size:20px;font-weight:980;letter-spacing:-.4px;">Guest</div>
        <div id="myPassText" class="muted" style="margin-top:8px;">ë¡œê·¸ì¸í•˜ë©´ ë‚´ íŒ¨ìŠ¤/QRì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</div>

        <button class="btn-main" style="background:#FEE500;color:#191919;margin-top:14px;" onclick="startKakaoLogin()">
          ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°
        </button>
      </div>

      <div class="tabs">
        <div class="tab active" id="tab-pass" onclick="switchMyTab('pass')">ë‚´ íŒ¨ìŠ¤</div>
        <div class="tab" id="tab-voucher" onclick="switchMyTab('voucher')">ë°”ìš°ì²˜</div>
        <div class="tab" id="tab-history" onclick="switchMyTab('history')">ì´ìš©ë‚´ì—­</div>
      </div>

      <div id="my-pass" class="pass-big">
        <div id="passStatus" class="pass-status">
          <span class="dot inactive"></span>
          <span>INACTIVE</span>
        </div>
        <div style="font-size:18px;font-weight:980;letter-spacing:-.3px;">Living Week (7ì¼)</div>
        <div class="muted" style="margin-top:6px;">QR ì œì‹œ í›„ ì œíœ´ì²˜ì—ì„œ í˜œíƒì´ ì ìš©ë¼ìš”.</div>

        <div class="pass-metrics">
          <div class="metric">
            <div class="k">ë‚¨ì€ ì‹œê°„</div>
            <div class="v" id="remainText">-</div>
          </div>
          <div class="metric">
            <div class="k">ì‚¬ìš© ê°€ëŠ¥ ì œíœ´ì²˜</div>
            <div class="v" id="partnerCount">-</div>
          </div>
        </div>

        <div style="display:flex;gap:10px;margin-top:14px;">
          <div class="pill primary" style="flex:1;justify-content:center;" onclick="openQR()">
            <i data-feather="maximize" style="width:16px;"></i> QR ë³´ê¸°
          </div>
          <div class="pill ghost" style="flex:1;justify-content:center;" onclick="switchTab('map')">
            <i data-feather="map" style="width:16px;"></i> ì œíœ´ì²˜ ì°¾ê¸°
          </div>
        </div>
      </div>

      <div id="my-voucher" style="display:none;">
        <div class="card">
          <div class="card-title">ë‚´ ì¿ í°/ë°”ìš°ì²˜</div>
          <div class="muted">ë°”ìš°ì²˜ ë²ˆí˜¸ Â· ì‚¬ìš© ì—¬ë¶€ Â· í˜œíƒì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</div>
        </div>
        <div class="list-group" id="voucherList"></div>
      </div>

      <div id="my-history" style="display:none;">
        <div class="card">
          <div class="card-title">ì´ìš© ë‚´ì—­ / ì˜ìˆ˜ì¦</div>
          <div class="muted">íšŒì‚¬ ì œì¶œìš© ì •ì‚°ì„ ê³ ë ¤í•œ â€œì„œë¹„ìŠ¤ê¸‰â€ êµ¬ì„±</div>
          <div style="margin-top:12px;">
            <div class="pill ghost" onclick="alert('PDF ë‹¤ìš´ë¡œë“œëŠ” í”„ë¡œí† íƒ€ì… ë‹¨ê³„ì—ì„œ ë²„íŠ¼ë§Œ ì œê³µ');">
              <i data-feather="download" style="width:14px;"></i> PDF ë‹¤ìš´ë¡œë“œ
            </div>
          </div>
        </div>
        <div class="list-group" id="historyList"></div>
      </div>

      <div class="list-group" style="margin-top:16px;">
        <div class="list-row" onclick="openSupport()"><span>ê³ ê°ì„¼í„°/ë¬¸ì˜</span><i data-feather="chevron-right" style="color:#c7c7c7;"></i></div>
        <div class="list-row" onclick="openLegal('terms')"><span>ì´ìš©ì•½ê´€</span><i data-feather="chevron-right" style="color:#c7c7c7;"></i></div>
        <div class="list-row" onclick="openLegal('privacy')"><span>ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</span><i data-feather="chevron-right" style="color:#c7c7c7;"></i></div>
        <div class="list-row" onclick="openLegal('refund')"><span>í™˜ë¶ˆ/ì·¨ì†Œ ì •ì±…</span><i data-feather="chevron-right" style="color:#c7c7c7;"></i></div>
        <div class="list-row" style="color:#FF3B30;" onclick="handleLogout()"><span>ë¡œê·¸ì•„ì›ƒ</span><i data-feather="log-out"></i></div>
      </div>
    </div>

    <!-- =========================
         SUPPORT
    ========================== -->
    <div id="view-support" class="view">
      <div class="card">
        <div class="card-title">ê³ ê°ì„¼í„° / ë¬¸ì˜</div>
        <div class="muted">
          ìš´ì˜ ì „ ì‹œì—°ìš© í™”ë©´ì…ë‹ˆë‹¤. ì‚¬ì—…ê³„íšì„œ ìˆ˜ì¤€ì˜ â€œì‹ ë¢° ìš”ì†Œâ€ë¥¼ ìœ„í•´ êµ¬ì„±í•´ë‘ì—ˆìŠµë‹ˆë‹¤.
        </div>
        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;">
          <div class="pill ghost" onclick="alert('ì´ë©”ì¼: support@bpass.example (ì‹œì—°ìš©)')">
            <i data-feather="mail" style="width:14px;"></i> ì´ë©”ì¼
          </div>
          <div class="pill ghost" onclick="alert('ì¹´ì¹´ì˜¤ì±„ë„: @bpassliving (ì‹œì—°ìš©)')">
            <i data-feather="message-circle" style="width:14px;"></i> ì¹´ì¹´ì˜¤ì±„ë„
          </div>
          <div class="pill ghost" onclick="openLegal('refund')">
            <i data-feather="rotate-ccw" style="width:14px;"></i> í™˜ë¶ˆê·œì •
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">FAQ</div>
        <div class="muted">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</div>

        <div style="margin-top:12px;display:flex;flex-direction:column;gap:10px;">
          <div class="card" style="margin:0;padding:16px;" onclick="toggleFaq(this)">
            <div class="row">
              <div style="font-weight:950;">íŒ¨ìŠ¤ êµ¬ë§¤ í›„ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜ìš”?</div>
              <i data-feather="chevron-down"></i>
            </div>
            <div class="muted" style="margin-top:10px;display:none;">
              ê²°ì œ ì™„ë£Œ í›„ íŒ¨ìŠ¤ê°€ ACTIVEë¡œ ì „í™˜ë˜ë©´ ì¦‰ì‹œ íŒ¨ìŠ¤ê°€ í™œì„±í™”ë©ë‹ˆë‹¤.
            </div>
          </div>

          <div class="card" style="margin:0;padding:16px;" onclick="toggleFaq(this)">
            <div class="row">
              <div style="font-weight:950;">ì œíœ´ì²˜ì—ì„œ ì–´ë–¤ í˜œíƒì„ ë°›ë‚˜ìš”?</div>
              <i data-feather="chevron-down"></i>
            </div>
            <div class="muted" style="margin-top:10px;display:none;">
              ì¥ì†Œ ìƒì„¸ í™”ë©´ì— â€œí˜œíƒ ë¬¸êµ¬(ì˜ˆ: íŒ¨ìŠ¤ ì†Œì§€ì 10% í• ì¸)â€ë¡œ ëª…í™•íˆ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
          </div>

          <div class="card" style="margin:0;padding:16px;" onclick="toggleFaq(this)">
            <div class="row">
              <div style="font-weight:950;">ì˜ìˆ˜ì¦/ì •ì‚° ìë£Œê°€ í•„ìš”í•´ìš”.</div>
              <i data-feather="chevron-down"></i>
            </div>
            <div class="muted" style="margin-top:10px;display:none;">
              MY &gt; ì´ìš©ë‚´ì—­ì—ì„œ ì‚¬ìš©ì²˜/ì‹œê°„/í˜œíƒ ì ìš© ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆê³ , PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ì œê³µí•©ë‹ˆë‹¤(ì‹œì—°ìš©).
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">ê²°ì œì•ˆì‹¬ ì•ˆë‚´</div>
        <div class="muted" style="line-height:1.5;">
          í† ìŠ¤ ê²°ì œ ìœ„ì ¯ ê¸°ë°˜(í”„ë¡œí† íƒ€ì…)ìœ¼ë¡œ â€œê²°ì œ ì‹ ë¢° ìš”ì†Œâ€ë¥¼ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.<br>
          ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ ì‹œì—ëŠ” ì•½ê´€/í™˜ë¶ˆ/ë¬¸ì˜ ì±„ë„ì„ í•¨ê»˜ ì œê³µí•´ ì‹ ë¢°ë„ë¥¼ ê°•í™”í•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <!-- =========================
         NAV
         [ìš”ì²­ ë°˜ì˜] âœ… í•˜ë‹¨ ë„¤ë¹„ì— "ì¶”ì²œ(â­)" í•­ëª© 1ê°œ ì¶”ê°€
         - ì´ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¶”ì²œ ëª¨ë‹¬ì´ ì—´ë¦¬ê³ , ê·¸ ì•ˆì—ì„œ ì¹´í…Œê³ ë¦¬ ì„ íƒ/ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
    ========================== -->
    <div class="nav-container">
      <div class="nav-dock">
        <div class="nav-item active" onclick="switchTab('home')"><i data-feather="home"></i></div>
        <div class="qr-btn" onclick="openQR()"><i data-feather="maximize" style="width:24px;height:24px;"></i></div>
        <div class="nav-item" onclick="switchTab('map')"><i data-feather="map"></i></div>

        <!-- âœ… ì¶”ê°€: ì¶”ì²œ(â­) -->
        <div class="nav-item" onclick="openRecommendModal()"><i data-feather="star"></i></div>

        <div class="nav-item" onclick="switchTab('my')"><i data-feather="user"></i></div>
        <div class="nav-item" onclick="switchTab('support')"><i data-feather="help-circle"></i></div>
      </div>
    </div>

    <!-- =========================
         ONBOARDING
    ========================== -->
    <div id="onboarding" class="onb">
      <div class="onb-card">
        <div class="onb-top">
          <div class="pill ghost" onclick="switchOnb(-1)"><i data-feather="chevron-left" style="width:14px;"></i> ì´ì „</div>
          <div class="skip" onclick="closeOnboarding()">ê±´ë„ˆë›°ê¸°</div>
        </div>

        <div class="onb-slide active">
          <div class="onb-h">BÂ·PASS Living</div>
          <div class="onb-desc">
            MICE ì²´ë¥˜ ì¤‘ í•„ìš”í•œ ì„œë¹„ìŠ¤ë¥¼ <b>íŒ¨ìŠ¤ í•˜ë‚˜</b>ë¡œ ì—°ê²°í•´ìš”.<br>
            êµí†µ Â· ì›Œí¬ìŠ¤í˜ì´ìŠ¤ Â· í—¬ìŠ¤ Â· ì‹ìŒí• ì¸ Â· ê¸´ê¸‰ì§€ì›ì„ í•œ ë²ˆì—.
          </div>
        </div>

        <div class="onb-slide">
          <div class="onb-h">ì•±ì²˜ëŸ¼ ê°„ë‹¨í•˜ê²Œ</div>
          <div class="onb-desc">
            â‘  ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ â†’ â‘¡ íŒ¨ìŠ¤ êµ¬ë§¤ â†’ â‘¢ QRë¡œ ì œíœ´ì²˜ ì´ìš©.<br>
            ì§€ë„ì—ì„œ ì œíœ´ì²˜ë¥¼ ì°¾ê³ , ìƒì„¸ í™”ë©´ì—ì„œ í˜œíƒì„ í™•ì¸í•˜ì„¸ìš”.
          </div>
        </div>

        <div class="onb-slide">
          <div class="onb-h">ì‹ ë¢° ìš”ì†Œê¹Œì§€</div>
          <div class="onb-desc">
            ì´ìš©ì•½ê´€/ê°œì¸ì •ë³´/í™˜ë¶ˆì •ì±…/ë¬¸ì˜ ì±„ë„ì„ ì œê³µí•´ìš”.<br>
            â€œì§„ì§œ ì„œë¹„ìŠ¤â€ì²˜ëŸ¼ ë³´ì´ê²Œ ë§Œë“œëŠ” í•µì‹¬ì…ë‹ˆë‹¤.
          </div>
        </div>

        <div class="dots">
          <div class="dot2 active"></div>
          <div class="dot2"></div>
          <div class="dot2"></div>
        </div>

        <div class="onb-actions">
          <div class="pill ghost" onclick="switchOnb(1)"><i data-feather="chevron-right" style="width:14px;"></i> ë‹¤ìŒ</div>
          <div class="pill primary" onclick="finishOnboarding()"><i data-feather="check" style="width:14px;"></i> ì‹œì‘í•˜ê¸°</div>
        </div>
      </div>
    </div>

    <!-- =========================
         LOGIN MODAL
    ========================== -->
    <div id="loginModal" class="overlay">
      <div class="modal">
        <div class="grab"></div>
        <h2>ë¡œê·¸ì¸</h2>
        <p>ì†Œì…œ ê³„ì •ìœ¼ë¡œ 3ì´ˆ ë§Œì— ì‹œì‘í•˜ì„¸ìš”. (ê²ŒìŠ¤íŠ¸ ëª¨ë“œë¡œë„ ë‘˜ëŸ¬ë³¼ ìˆ˜ ìˆì–´ìš”)</p>
        <button class="btn-main" style="background:#FEE500;color:#191919;" onclick="startKakaoLogin()">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</button>
        <button class="btn-sub" onclick="closeModal('loginModal')">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- =========================
         LANG MODAL
    ========================== -->
    <div id="langModal" class="overlay">
      <div class="modal">
        <div class="grab"></div>
        <h2>ì–¸ì–´ ì„ íƒ</h2>
        <p>ì–´ë–¤ ì–¸ì–´ë¡œ ë³¼ê¹Œìš”?</p>

        <div style="margin-top:14px;display:flex;flex-direction:column;gap:10px;">
          <div class="pill ghost" onclick="selectLang('kr')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</div>
          <div class="pill ghost" onclick="selectLang('en')">ğŸ‡ºğŸ‡¸ English</div>
          <div class="pill ghost" onclick="selectLang('cn')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</div>
          <div class="pill ghost" onclick="selectLang('jp')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</div>
        </div>

        <button class="btn-sub" onclick="closeModal('langModal')">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- =========================
         PASS DETAIL MODAL
    ========================== -->
    <div id="passDetailModal" class="overlay">
      <div class="modal" style="position:relative;">
        <div class="grab"></div>

        <div class="row" style="align-items:flex-start;">
          <div>
            <div class="tag">EARLY BIRD</div>
            <h2 style="margin:0;">Living Week (7ì¼)</h2>
            <p style="margin-top:8px;">
              MICE ì°¸ê°€ìì˜ â€œì²´ë¥˜ ë¶ˆí¸â€ì„ ì¤„ì´ê¸° ìœ„í•œ ì˜¬ì¸ì› íŒ¨ìŠ¤.
            </p>
          </div>
          <div class="pill ghost" onclick="closeModal('passDetailModal')">
            <i data-feather="x" style="width:14px;"></i> ë‹«ê¸°
          </div>
        </div>

        <div class="card" style="margin-top:14px;">
          <div class="card-title">í¬í•¨ ì„œë¹„ìŠ¤</div>
          <div class="muted" style="line-height:1.55;">
            êµí†µ Â· ì›Œí¬ìŠ¤í˜ì´ìŠ¤ Â· í—¬ìŠ¤ Â· ì¹´í˜/ì‹ìŒ í• ì¸ Â· ê¸´ê¸‰ì§€ì› Â· ì •ì‚°ìš© ì´ìš©ë‚´ì—­ Â· ì¿ í°/ë°”ìš°ì²˜
          </div>
        </div>

        <div class="card">
          <div class="card-title">êµí†µ(íƒì‹œ ì´ìš©ê¶Œ Â· ì§€ê¸‰í˜•)</div>
          <div class="muted" style="line-height:1.55;">
            íƒì‹œëŠ” <b style="color:var(--text);">ì‚¬ì „ ê²°ì œëœ ì´ìš©ê¶Œ(ì¿ í°ë²ˆí˜¸)</b> í˜•íƒœë¡œ ì œê³µë¼ìš”.<br>
            MY &gt; ë°”ìš°ì²˜ì—ì„œ <b style="color:var(--text);">ì¿ í°ë²ˆí˜¸/ì‚¬ìš©ì—¬ë¶€</b>ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.
          </div>
          <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
            <div class="pill ghost" onclick="openTaxiBiz(); event.stopPropagation();">
              <i data-feather="external-link" style="width:14px;"></i> íƒì‹œ ì´ìš©ê¶Œ ì•ˆë‚´
            </div>
            <div class="pill ghost" onclick="switchTab('map'); filterMapAndGo('transport'); closeModal('passDetailModal'); event.stopPropagation();">
              <i data-feather="map-pin" style="width:14px;"></i> êµí†µ(íƒì‹œ) ë³´ê¸°
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ìˆ™ì†Œ(ì¶”ì²œí˜•)</div>
          <div class="muted" style="line-height:1.55;">
            íŒ¨ìŠ¤ ê°€ê²©ì— ìˆ™ì†Œë¥¼ í¬í•¨í•˜ì§€ ì•Šê³ , <b style="color:var(--text);">ë²¡ìŠ¤ì½”Â·ë¶€ì‚°í•­ ì¸ê·¼ ì¶”ì²œ ìˆ™ì†Œ</b>ë¥¼ ì•ˆë‚´í•´ìš”.<br>
            (ì˜ˆì•½/ê²°ì œëŠ” ìˆ™ì†Œë³„ ì±„ë„ì—ì„œ ì§„í–‰)
          </div>
          <div style="margin-top:12px;">
            <div class="pill ghost" onclick="openRecommendModal(); event.stopPropagation();">
              <i data-feather="star" style="width:14px;"></i> ìˆ™ì†Œ ì¶”ì²œ ë³´ê¸°
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ì´ìš© ê°€ëŠ¥ ì§€ì—­/ì œíœ´ì²˜</div>
          <div class="muted">ì§€ë„ì—ì„œ ì¹´í…Œê³ ë¦¬ í•„í„°ë¡œ ì œíœ´ì²˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</div>
          <div style="margin-top:12px;">
            <div class="pill ghost" onclick="switchTab('map'); closeModal('passDetailModal');">
              <i data-feather="map-pin" style="width:14px;"></i> ì œíœ´ì²˜ ì§€ë„ ë³´ê¸°
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ìœ ì˜ì‚¬í•­/í™˜ë¶ˆ ìš”ì•½</div>
          <div class="muted" style="line-height:1.55;">
            ê²°ì œ í›„ ì‚¬ìš© ì „/í›„ ìƒíƒœì— ë”°ë¼ í™˜ë¶ˆ ê·œì •ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì‹œì—°ìš©).<br>
            ìì„¸í•œ ë‚´ìš©ì€ â€œí™˜ë¶ˆ/ì·¨ì†Œ ì •ì±…â€ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”.
          </div>
          <div style="margin-top:12px;">
            <div class="pill ghost" onclick="openLegal('refund')">
              <i data-feather="rotate-ccw" style="width:14px;"></i> í™˜ë¶ˆ/ì·¨ì†Œ ì •ì±… ë³´ê¸°
            </div>
          </div>
        </div>

        <div style="position:sticky;bottom:0;background:linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.96) 35%, rgba(255,255,255,1) 100%);padding-top:10px;">
          <div class="row" style="align-items:flex-end;">
            <div>
              <div class="price-old">ì •ê°€ 129,000ì›</div>
              <div class="price-new">ì–¼ë¦¬ë²„ë“œ 99,000ì›</div>
            </div>
            <button class="buy-btn" style="width:170px;" onclick="openPayment()">êµ¬ë§¤/ê²°ì œ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- =========================
         PAYMENT MODAL
    ========================== -->
    <div id="paymentSheet" class="overlay">
      <div class="modal">
        <div class="grab"></div>
        <h2 id="payName">Living Week (7ì¼)</h2>
        <p id="payPrice"><b style="color:var(--primary);">ì–¼ë¦¬ë²„ë“œ 99,000ì›</b> (ì •ê°€ 129,000ì›)</p>
        <div class="muted" style="margin-top:8px;">ì•„ë˜ ê²°ì œìˆ˜ë‹¨ ì„ íƒ í›„ ê²°ì œí•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>

        <div id="payment-method" style="margin-top:14px;"></div>

        <button class="btn-main" id="btnPayNow" onclick="requestPay()">ê²°ì œí•˜ê¸°</button>
        <button class="btn-sub" onclick="closeModal('paymentSheet')">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- =========================
         QR MODAL
    ========================== -->
    <div id="qrModal" class="overlay">
      <div class="modal" style="text-align:center;">
        <div class="grab"></div>

        <div class="cert-wrap" style="text-align:left;">
          <div class="cert">
            <div class="cert-top">
              <div class="cert-brand">
                <div class="b1">
                  <span style="display:inline-flex;align-items:center;gap:8px;">
                    <span style="width:10px;height:10px;border-radius:50%;background:rgba(204,248,2,.95);box-shadow:0 0 0 6px rgba(204,248,2,.16);"></span>
                    BÂ·PASS Living
                  </span>
                </div>

                <div id="certChip" class="cert-chip">
                  <span class="mini-dot"></span>
                  <span id="certStatusText">INACTIVE</span>
                </div>
              </div>

              <div class="cert-qr">
                <img id="qrImg"
                     src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=BPASS"
                     alt="B-PASS QR" />
              </div>
            </div>

            <div class="cert-mid">
              <div class="cert-name" id="certName">Guest</div>
              <div class="cert-sub" id="certSub">
                ë¹„íŒ¨ìŠ¤ íšŒì›ì¦(ì‹œì—°ìš©) Â· ì œíœ´ì²˜ì—ì„œ QRë¡œ ì¸ì¦í•˜ì„¸ìš”.
              </div>

              <div class="cert-grid">
                <div class="cert-field">
                  <div class="k">íšŒì› ID</div>
                  <div class="v" id="certMemberId">-</div>
                </div>
                <div class="cert-field">
                  <div class="k">íŒ¨ìŠ¤</div>
                  <div class="v" id="certPlan">Living Week (7ì¼)</div>
                </div>
                <div class="cert-field">
                  <div class="k">ë°œê¸‰ì¼</div>
                  <div class="v" id="certIssuedAt">-</div>
                </div>
                <div class="cert-field">
                  <div class="k">ë§Œë£Œ</div>
                  <div class="v" id="certExpireAt">-</div>
                </div>
              </div>

              <div class="cert-bar"></div>

              <div class="cert-foot">
                <div class="mini" id="qrRemain">ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥</div>
                <div class="pill" onclick="switchTab('my'); closeModal('qrModal');">
                  <i data-feather="user" style="width:14px;"></i> MYë¡œ ì´ë™
                </div>
              </div>
            </div>
          </div>
        </div>

        <button class="btn-sub" onclick="closeModal('qrModal')">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- =========================
         PLACE BOTTOM SHEET
    ========================== -->
    <div id="placeSheet" class="sheet-overlay" onclick="closePlaceSheet(event)">
      <div class="sheet" onclick="event.stopPropagation()">
        <div class="grab"></div>
        <div class="place-head">
          <div>
            <div class="place-name" id="psName">ì¥ì†Œëª…</div>
            <div class="place-meta" id="psMeta">ì¹´í…Œê³ ë¦¬ Â· ìš´ì˜ì‹œê°„ Â· ê±°ë¦¬</div>
            <div class="benefit-badge" id="psBenefit">
              <i data-feather="percent" style="width:14px;"></i> íŒ¨ìŠ¤ ì†Œì§€ì í˜œíƒ
            </div>
          </div>
          <div class="pill ghost" onclick="hidePlaceSheet()">
            <i data-feather="x" style="width:14px;"></i>
          </div>
        </div>

        <div class="muted" id="psDesc" style="line-height:1.55;">
          ìƒì„¸ ì„¤ëª… ì˜ì—­
        </div>

        <div class="sheet-actions" id="sheetActions">
          <div class="pill primary" onclick="openQR()"><i data-feather="maximize" style="width:16px;"></i> QR ì œì‹œ</div>
          <div class="pill ghost" onclick="openDirections()"><i data-feather="navigation" style="width:16px;"></i> ê¸¸ì°¾ê¸°</div>
          <div class="pill ghost" onclick="alert('í˜œíƒ/ì´ìš©ì¡°ê±´ì€ ì‹œì—°ìš© ë¬¸êµ¬ì…ë‹ˆë‹¤.')"><i data-feather="info" style="width:16px;"></i> ì´ìš©ì¡°ê±´</div>
        </div>
      </div>
    </div>

    <!-- =========================
         LEGAL MODAL
    ========================== -->
    <div id="legalModal" class="overlay">
      <div class="modal">
        <div class="grab"></div>
        <div class="row">
          <h2 id="legalTitle" style="margin:0;">ì•½ê´€</h2>
          <div class="pill ghost" onclick="closeModal('legalModal')"><i data-feather="x" style="width:14px;"></i> ë‹«ê¸°</div>
        </div>
        <div id="legalBody" class="muted" style="margin-top:12px;line-height:1.6;white-space:pre-line;"></div>
      </div>
    </div>

    <!-- ==========================================================
         âœ… ì¶”ì²œ ëª¨ë‹¬ (í•˜ë‹¨ ë„¤ë¹„ â­ ë²„íŠ¼ ì „ìš©)
         - ëª¨ë‹¬ ì•ˆì—ì„œ ì¹´í…Œê³ ë¦¬(ìˆ™ì†Œ/ì¹´í˜/ìŒì‹ì /ê³µìœ ì˜¤í”¼ìŠ¤) ì„ íƒ
         - ì„ íƒ ì¦‰ì‹œ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ ë³€ê²½
    ========================================================== -->
    <div id="recommendModal" class="overlay">
      <div class="modal">
        <div class="grab"></div>

        <div class="row" style="align-items:flex-start;">
          <div>
            <h2 id="recModalTitle" style="margin:0;">ì¶”ì²œ</h2>
            <p id="recModalDesc" style="margin-top:8px;">ì¹´í…Œê³ ë¦¬ë³„ ì¶”ì²œ í•­ëª©ì„ ì„ íƒí•´ í™•ì¸í•˜ì„¸ìš”. (ì‹œì—°ìš©)</p>
          </div>
          <div class="pill ghost" onclick="closeModal('recommendModal')">
            <i data-feather="x" style="width:14px;"></i> ë‹«ê¸°
          </div>
        </div>

        <!-- âœ… ëª¨ë‹¬ ë‚´ë¶€ ì¹´í…Œê³ ë¦¬ ì„ íƒ íƒ­ -->
        <div class="tabs" style="margin-top:14px;">
          <div class="tab active" id="rm-stay" onclick="setRecommendCat('stay', true)">ìˆ™ì†Œ</div>
          <div class="tab" id="rm-cafe" onclick="setRecommendCat('food', true)">ì¹´í˜</div>
          <div class="tab" id="rm-restaurant" onclick="setRecommendCat('restaurant', true)">ìŒì‹ì </div>
          <div class="tab" id="rm-office" onclick="setRecommendCat('office', true)">ê³µìœ  ì˜¤í”¼ìŠ¤</div>
        </div>

        <div class="rec-list" id="recModalList"></div>

        <button class="btn-sub" onclick="closeModal('recommendModal')">ë‹«ê¸°</button>
      </div>
    </div>

  </div>

  <script>
    feather.replace();

    let map = null;
    let markers = [];
    let myMarker = null;
    let lastOpenedPartner = null;
    let currentFilter = "all";
    let currentPartnerIdForDirections = null;

    const state = {
      loggedIn:false,
      user:null,
      pass:null,
      tossClientKey:null,
      plan:null,
      paymentWidget:null,
      pendingOrder:null,
      myTab:"pass",

      // ì¶”ì²œ(ëª¨ë‹¬) í˜„ì¬ ì„ íƒ
      recommendCat: "stay"
    };

    const TAXI_BIZ_URL = "https://biz.giftishow.com/ggoods/detail?goodsNo=38310&goodsCode=G00001404576";

    const CATS = [
      { id:"all", label:"ì „ì²´" },
      { id:"office", label:"ì›Œí¬ìŠ¤í˜ì´ìŠ¤" },
      { id:"food", label:"ì¹´í˜" },
      { id:"restaurant", label:"ìŒì‹ì " },
      { id:"gym", label:"í—¬ìŠ¤" },
      { id:"transport", label:"êµí†µ" },
      { id:"stay", label:"ìˆ™ì†Œ(ì¶”ì²œ)" },
      { id:"pharmacy", label:"ì•½êµ­" },
      { id:"hospital", label:"ë³‘ì›" },
      { id:"exchange", label:"í™˜ì „" },
    ];

    // ë¶€ì‚° ì£¼ìš” í•­ëª© ìƒ˜í”Œ
    const partners = [
      { id:"p1", name:"WeWork Partner Space", cat:"office", coords:[35.1631,129.1635], hours:"10:00-18:00",
        benefit:"ë°ì´íŒ¨ìŠ¤ 10% í• ì¸", desc:"ì œíœ´ ì½”ì›Œí‚¹ ìŠ¤í˜ì´ìŠ¤. ì¢Œì„/íšŒì˜ì‹¤ ì´ìš© í˜œíƒ ì œê³µ(ì‹œì—°ìš©)." },
      { id:"p2", name:"Coffee Partner", cat:"food", coords:[35.1595,129.0604], hours:"08:00-22:00",
        benefit:"10% í• ì¸", desc:"íŒ¨ìŠ¤ ì†Œì§€ì ì¹´í˜ ë©”ë‰´ 10% í• ì¸(ì‹œì—°ìš©)." },
      { id:"p3", name:"Fitness Partner", cat:"gym", coords:[35.1060,129.0320], hours:"06:00-24:00",
        benefit:"ì…ì¥ 1íšŒ í˜œíƒ", desc:"ì œíœ´ í”¼íŠ¸ë‹ˆìŠ¤ ì˜ˆì‹œ. íŒ¨ìŠ¤ ì†Œì§€ì ì „ìš© í˜œíƒ(ì‹œì—°ìš©)." },
      { id:"p4", name:"Exchange Partner", cat:"exchange", coords:[35.1602,129.0612], hours:"10:00-18:00",
        benefit:"í™˜ìœ¨ ìš°ëŒ€ ì•ˆë‚´", desc:"í™˜ì „/ê²°ì œ í¸ì˜ ì•ˆë‚´(ì‹œì—°ìš©)." },
      { id:"p5", name:"Pharmacy Partner", cat:"pharmacy", coords:[35.1584,129.0630], hours:"09:00-21:00",
        benefit:"ê¸°ë³¸ ìƒë‹´ ì•ˆë‚´", desc:"ê¸´ê¸‰ ì§€ì› UX(ì•½êµ­/ì˜ë£Œ/ë¶„ì‹¤) ì—°ê²°ì„ ìœ„í•œ ì œíœ´ì²˜ ì˜ˆì‹œ." },
      { id:"p6", name:"Clinic Partner", cat:"hospital", coords:[35.1611,129.0588], hours:"10:00-17:00",
        benefit:"ê¸´ê¸‰ ì—°ê²° ì•ˆë‚´", desc:"ì˜ë£Œ/ê¸´ê¸‰ ì§€ì› ë™ì„  UXë¥¼ ìœ„í•œ ì˜ˆì‹œ ì œíœ´ì²˜." },

      { id:"taxiVoucher", name:"íƒì‹œ ì´ìš©ê¶Œ (ì¿ í° ì§€ê¸‰í˜•)", cat:"transport", coords:[35.1681,129.1366], hours:"ìƒì‹œ",
        benefit:"ì¿ í°ë²ˆí˜¸ ì œê³µ(ì‚¬ì „ ê²°ì œ)", desc:"Giftishow bizì—ì„œ ì‚¬ì „ ê²°ì œí•œ íƒì‹œ ì´ìš©ê¶Œì„ íŒ¨ìŠ¤ ì‚¬ìš©ìì—ê²Œ ì¿ í°ë²ˆí˜¸ë¡œ ì œê³µ(ì‹œì—°ìš©)." },

      { id:"stay1", name:"BEXCO Nearby Hotel A (ì¶”ì²œ)", cat:"stay", coords:[35.1688,129.1362], hours:"ì²´í¬ì¸/ì•„ì›ƒ: ìˆ™ì†Œë³„ ìƒì´",
        benefit:"ì¶”ì²œ(í• ì¸/ì œê³µ X)", desc:"íŒ¨ìŠ¤ì— ìˆ™ì†Œ ë¹„ìš©ì€ í¬í•¨ë˜ì§€ ì•Šìœ¼ë©°, í–‰ì‚¬ì¥ ì¸ê·¼ ìˆ™ì†Œë¥¼ ì¶”ì²œ í˜•íƒœë¡œ ì•ˆë‚´í•©ë‹ˆë‹¤(ì‹œì—°ìš©)." },
      { id:"stay2", name:"Busan Port Nearby Hotel B (ì¶”ì²œ)", cat:"stay", coords:[35.1004,129.0406], hours:"ì²´í¬ì¸/ì•„ì›ƒ: ìˆ™ì†Œë³„ ìƒì´",
        benefit:"ì¶”ì²œ(í• ì¸/ì œê³µ X)", desc:"ë¶€ì‚°í•­ ì¸ê·¼ ìˆ™ì†Œ ì¶”ì²œ(ì‹œì—°ìš©). ì˜ˆì•½/ê²°ì œëŠ” ìˆ™ì†Œ ì±„ë„ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤." },
      { id:"stay3", name:"Haeundae Stay C (ì¶”ì²œ)", cat:"stay", coords:[35.1636,129.1639], hours:"ì²´í¬ì¸/ì•„ì›ƒ: ìˆ™ì†Œë³„ ìƒì´",
        benefit:"ì¶”ì²œ(í• ì¸/ì œê³µ X)", desc:"í•´ìš´ëŒ€ ê¶Œì—­ ìˆ™ì†Œ ì¶”ì²œ(ì‹œì—°ìš©). í–‰ì‚¬/ê´€ê´‘ ë™ì„ ì— ì í•©." },
      { id:"stay4", name:"Seomyeon Stay D (ì¶”ì²œ)", cat:"stay", coords:[35.1577,129.0592], hours:"ì²´í¬ì¸/ì•„ì›ƒ: ìˆ™ì†Œë³„ ìƒì´",
        benefit:"ì¶”ì²œ(í• ì¸/ì œê³µ X)", desc:"ì„œë©´ ê¶Œì—­ ìˆ™ì†Œ ì¶”ì²œ(ì‹œì—°ìš©). êµí†µ ì ‘ê·¼ì„± ì¤‘ì‹¬." },

      { id:"cafe1", name:"Gwangalli Coffee Spot", cat:"food", coords:[35.1531,129.1188], hours:"09:00-23:00",
        benefit:"íŒ¨ìŠ¤ 10% í• ì¸(ì‹œì—°)", desc:"ê´‘ì•ˆë¦¬ ì¸ê·¼ ì¹´í˜ ì¶”ì²œ(ì‹œì—°ìš©). ì—…ë¬´/ë¯¸íŒ… ìŠ¤íŒŸ." },
      { id:"cafe2", name:"Centum Coffee Lounge", cat:"food", coords:[35.1695,129.1305], hours:"08:30-21:30",
        benefit:"íŒ¨ìŠ¤ 10% í• ì¸(ì‹œì—°)", desc:"ì„¼í…€ì‹œí‹° ê¶Œì—­ ì¹´í˜(ì‹œì—°ìš©). ì „ì‹œ/í–‰ì‚¬ ì „í›„ ë™ì„ ." },
      { id:"cafe3", name:"Nampo Coffee Bar", cat:"food", coords:[35.0975,129.0347], hours:"10:00-22:00",
        benefit:"íŒ¨ìŠ¤ 10% í• ì¸(ì‹œì—°)", desc:"ë‚¨í¬ë™ ì¸ê·¼ ì¹´í˜(ì‹œì—°ìš©). ê´€ê´‘ ë™ì„ ê³¼ ê²°í•©." },

      { id:"rest1", name:"Busan Local Dining (Seomyeon)", cat:"restaurant", coords:[35.1579,129.0583], hours:"11:00-22:00",
        benefit:"íŒ¨ìŠ¤ ë©”ë‰´ 5% í˜œíƒ(ì‹œì—°)", desc:"ì„œë©´ ê¶Œì—­ ìŒì‹ì  ì¶”ì²œ(ì‹œì—°ìš©). íšŒì‹/ë¯¸íŒ… ì‹ì‚¬." },
      { id:"rest2", name:"Haeundae Seafood Table", cat:"restaurant", coords:[35.1639,129.1630], hours:"12:00-22:00",
        benefit:"íŒ¨ìŠ¤ ìŒë£Œ ì œê³µ(ì‹œì—°)", desc:"í•´ìš´ëŒ€ ê¶Œì—­ í•´ì‚°ë¬¼/ì‹ì‚¬(ì‹œì—°ìš©). ê´€ê´‘+ì‹ì‚¬ ë™ì„ ." },
      { id:"rest3", name:"Nampo Street Food Pick", cat:"restaurant", coords:[35.0978,129.0340], hours:"12:00-21:00",
        benefit:"íŒ¨ìŠ¤ ì†Œì§€ì ì„œë¹„ìŠ¤(ì‹œì—°)", desc:"ë‚¨í¬/ìê°ˆì¹˜ ê¶Œì—­ ê°„í¸ì‹/ë¡œì»¬(ì‹œì—°ìš©)." },
      { id:"rest4", name:"Gwangan Night Dining", cat:"restaurant", coords:[35.1536,129.1182], hours:"17:00-01:00",
        benefit:"íŒ¨ìŠ¤ ì†Œì§€ì 5% í˜œíƒ(ì‹œì—°)", desc:"ê´‘ì•ˆë¦¬ ê¶Œì—­ ì•¼ê°„ ì‹ì‚¬/ëª¨ì„(ì‹œì—°ìš©)." },

      { id:"off2", name:"Busan Co-Office (Centum)", cat:"office", coords:[35.1701,129.1309], hours:"09:00-19:00",
        benefit:"ë°ì´íŒ¨ìŠ¤ 10% í˜œíƒ(ì‹œì—°)", desc:"ì„¼í…€ ê¶Œì—­ ê³µìœ ì˜¤í”¼ìŠ¤(ì‹œì—°ìš©). íšŒì˜ì‹¤/ë¼ìš´ì§€." },
      { id:"off3", name:"Seomyeon Work Hub", cat:"office", coords:[35.1571,129.0599], hours:"09:00-20:00",
        benefit:"ë°ì´íŒ¨ìŠ¤ 10% í˜œíƒ(ì‹œì—°)", desc:"ì„œë©´ ê¶Œì—­ ê³µìœ ì˜¤í”¼ìŠ¤(ì‹œì—°ìš©). êµí†µ ì¤‘ì‹¬." },
      { id:"off4", name:"Busan Station Work Lounge", cat:"office", coords:[35.1151,129.0412], hours:"09:00-18:00",
        benefit:"ë¼ìš´ì§€ ì´ìš© í˜œíƒ(ì‹œì—°)", desc:"ë¶€ì‚°ì—­ ê¶Œì—­ ë¼ìš´ì§€(ì‹œì—°ìš©). ì´ë™ ì§ì „ ì—…ë¬´." },
    ];

    function closeModal(id){ document.getElementById(id).style.display="none"; }
    function openModal(id){ document.getElementById(id).style.display="flex"; feather.replace(); }

    function fmtRemain(endIso){
      if(!endIso) return "-";
      const end = new Date(endIso).getTime();
      const now = Date.now();
      let diff = Math.max(0,end-now);
      const d = Math.floor(diff/(1000*60*60*24)); diff -= d*(1000*60*60*24);
      const h = Math.floor(diff/(1000*60*60)); diff -= h*(1000*60*60);
      const m = Math.floor(diff/(1000*60));
      return `${d}ì¼ ${h}ì‹œê°„ ${m}ë¶„`;
    }

    function fmtDate(iso){
      if(!iso) return "-";
      const dt = new Date(iso);
      if(isNaN(dt.getTime())) return "-";
      const y = dt.getFullYear();
      const mo = String(dt.getMonth()+1).padStart(2,"0");
      const da = String(dt.getDate()).padStart(2,"0");
      return `${y}.${mo}.${da}`;
    }

    async function api(path,opt={}){
      const res = await fetch(path,{
        ...opt,
        headers:{ "Content-Type":"application/json", ...(opt.headers||{}) }
      });
      let data=null;
      try{ data = await res.json(); }catch{}
      if(!res.ok) throw (data||{error:"HTTP_ERROR"});
      return data;
    }

    /* Onboarding */
    let onbIndex = 0;
    function showOnboarding(){
      document.getElementById("onboarding").style.display="flex";
      onbIndex = 0;
      renderOnb();
    }
    function closeOnboarding(){ document.getElementById("onboarding").style.display="none"; }
    function renderOnb(){
      const slides = document.querySelectorAll(".onb-slide");
      const dots = document.querySelectorAll(".dot2");
      slides.forEach((s,i)=>s.classList.toggle("active", i===onbIndex));
      dots.forEach((d,i)=>d.classList.toggle("active", i===onbIndex));
      feather.replace();
    }
    function switchOnb(dir){
      if(dir === -1) onbIndex = Math.max(0, onbIndex-1);
      else onbIndex = Math.min(2, onbIndex+1);
      renderOnb();
    }
    function finishOnboarding(){
      localStorage.setItem("bpass_onboarding_done","1");
      closeOnboarding();
    }

    /* Carousel */
    function catLabel(id){
      const c = CATS.find(x=>x.id===id);
      return c ? c.label : id;
    }

    function renderCarousel(){
      const el = document.getElementById("partnerCarousel");
      el.innerHTML = "";

      const top = [
        partners.find(p=>p.cat==="office"),
        partners.find(p=>p.cat==="food"),
        partners.find(p=>p.cat==="gym"),
        partners.find(p=>p.id==="taxiVoucher"),
      ].filter(Boolean);

      top.forEach(p=>{
        const card = document.createElement("div");
        card.className = "partner";
        card.innerHTML = `
          <div class="partner-cat">${catLabel(p.cat)}</div>
          <div class="partner-name">${p.name}</div>
          <div class="partner-benefit">í˜œíƒ: ${p.benefit}</div>
          <div class="partner-actions">
            <div class="pill ghost" onclick="switchTab('map'); focusPartner('${p.id}')">
              <i data-feather="map-pin" style="width:14px;"></i> ì§€ë„ì—ì„œ ë³´ê¸°
            </div>
            <div class="pill ghost" onclick="openPartnerSheet('${p.id}')">
              <i data-feather="info" style="width:14px;"></i> ìƒì„¸
            </div>
          </div>
        `;
        el.appendChild(card);
      });
      feather.replace();
    }

    /* Login/Me */
    function checkLogin(){ openModal("loginModal"); }
    function startKakaoLogin(){ window.location.href="/auth/kakao/start"; }

    async function loadMe(){
      try{
        const me = await api("/api/me");
        state.loggedIn = true;
        state.user = me.user;
        state.pass = me.pass;
        state.tossClientKey = me.tossClientKey;
        state.plan = me.plan;
      }catch(e){
        state.loggedIn = false;
        state.user = null;
        state.pass = null;
        state.tossClientKey = null;
        state.plan = null;
      }
      renderAuthUI();
      renderMy();
      renderQR();
      renderRecommendModal();  // âœ… ì¶”ì²œ ëª¨ë‹¬ ë¦¬ìŠ¤íŠ¸ ì¤€ë¹„
    }

    function renderAuthUI(){
      const badge = document.getElementById("guestBadge");
      badge.style.display = state.loggedIn ? "none" : "inline-flex";

      const bal = document.getElementById("balance");
      const wa = document.getElementById("walletActions");

      if(!state.loggedIn){
        bal.innerText = "ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”";
        wa.style.display = "none";
        return;
      }
      if(state.pass && state.pass.status==="ACTIVE"){
        bal.innerText = `ACTIVE Â· ${fmtRemain(state.pass.end_at)}`;
      } else {
        bal.innerText = "íŒ¨ìŠ¤ ì—†ìŒ Â· êµ¬ë§¤ í›„ QR ì‚¬ìš©";
      }
      wa.style.display = "flex";
    }

    async function handleLogout(){
      if(!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      try{ await api("/api/logout",{method:"POST"}); }catch{}
      await loadMe();
      alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
      switchTab("home");
    }

    /* Payment */
    function openPassDetail(){ openModal("passDetailModal"); }

    async function openPayment(){
       // ===== [ì¶”ê°€] ì‹œì—°ìš©: ê²°ì œ ì„±ê³µì²˜ë¦¬ë§Œ =====
      window.location.href = "/success.html";
      return;
      if(!state.loggedIn){ checkLogin(); return; }
      if(!state.tossClientKey){
        alert("í† ìŠ¤ ê²°ì œ í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤(.envì˜ TOSS_CLIENT_KEY í™•ì¸).");
        return;
      }
      try{
        const order = await api("/api/orders/create",{method:"POST"});
        state.pendingOrder = order;

        document.getElementById("payName").innerText = order.orderName || "Living Week (7ì¼)";
        document.getElementById("payPrice").innerHTML = `<b style="color:var(--primary);">ì–¼ë¦¬ë²„ë“œ 99,000ì›</b> (ì •ê°€ 129,000ì›)`;

        openModal("paymentSheet");
        const customerKey = "customer_" + state.user.id;
        state.paymentWidget = PaymentWidget(state.tossClientKey, customerKey);

        document.getElementById("payment-method").innerHTML = "";
        state.paymentWidget.renderPaymentMethods("#payment-method",{value:order.amount});
      }catch(e){
        alert("ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨");
      }
    }

    async function requestPay(){

       // ===== [ì¶”ê°€] ì‹œì—°ìš©: ê²°ì œ ì„±ê³µì²˜ë¦¬ë§Œ =====
      window.location.href = "/success.html";
      return;
      if(!state.paymentWidget || !state.pendingOrder){
        alert("ê²°ì œ ì¤€ë¹„ê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        return;
      }
      try{
        await state.paymentWidget.requestPayment({
          orderId: state.pendingOrder.orderId,
          orderName: state.pendingOrder.orderName,
          successUrl: state.pendingOrder.successUrl,
          failUrl: state.pendingOrder.failUrl
        });
      }catch(e){
        alert("ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆê±°ë‚˜ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      }
    }

    /* QR */
    function openQR(){
      renderQR();
      openModal("qrModal");
    }

    function renderQR(){
      const img = document.getElementById("qrImg");
      const remain = document.getElementById("qrRemain");

      const certName = document.getElementById("certName");
      const certMemberId = document.getElementById("certMemberId");
      const certPlan = document.getElementById("certPlan");
      const certIssuedAt = document.getElementById("certIssuedAt");
      const certExpireAt = document.getElementById("certExpireAt");
      const certChip = document.getElementById("certChip");
      const certStatusText = document.getElementById("certStatusText");

      const issued = fmtDate(new Date().toISOString());

      if(!state.loggedIn){
        img.src = "https://api.qrserver.com/v1/create-qr-code/?size=170x170&data=LOGIN_REQUIRED";
        remain.innerText = "ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥";

        certName.innerText = "Guest";
        certMemberId.innerText = "-";
        certPlan.innerText = "Living Week (7ì¼)";
        certIssuedAt.innerText = issued;
        certExpireAt.innerText = "-";
        certChip.classList.remove("active");
        certStatusText.innerText = "INACTIVE";
        return;
      }

      certName.innerText = state.user?.name || "User";
      certMemberId.innerText = `BP-${String(state.user?.id || "").padStart(6,"0")}`;
      certPlan.innerText = "Living Week (7ì¼)";
      certIssuedAt.innerText = issued;

      if(!state.pass || state.pass.status!=="ACTIVE"){
        img.src = "https://api.qrserver.com/v1/create-qr-code/?size=170x170&data=NO_PASS";
        remain.innerText = "íŒ¨ìŠ¤ êµ¬ë§¤ í›„ QR ì‚¬ìš©";

        certExpireAt.innerText = "-";
        certChip.classList.remove("active");
        certStatusText.innerText = "INACTIVE";
        return;
      }

      const qrText = `BPASS:${state.user.id}:${state.pass.plan_id}:${state.pass.end_at}`;
      img.src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(qrText)}`;
      remain.innerText = `ë‚¨ì€ ì‹œê°„ ${fmtRemain(state.pass.end_at)}`;

      certExpireAt.innerText = fmtDate(state.pass.end_at);
      certChip.classList.add("active");
      certStatusText.innerText = "ACTIVE";
    }

    /* Tabs */
    function switchTab(tab){
      document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
      document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));

      // nav-item ìˆœì„œ(ì¤‘ìš”): home(0), map(1), star(2), my(3), support(4)

      if(tab==="home"){
        document.getElementById("view-home").classList.add("active");
        document.querySelectorAll(".nav-item")[0].classList.add("active");
      } else if(tab==="map"){
        document.getElementById("view-map").classList.add("active");
        document.querySelectorAll(".nav-item")[1].classList.add("active");
        initMap();
      } else if(tab==="my"){
        document.getElementById("view-my").classList.add("active");
        document.querySelectorAll(".nav-item")[3].classList.add("active");
        setTimeout(()=>renderMy(),0);
      } else if(tab==="support"){
        document.getElementById("view-support").classList.add("active");
        document.querySelectorAll(".nav-item")[4].classList.add("active");
      }

      feather.replace();
    }

    function openMyPass(){
      switchTab("my");
      switchMyTab("pass");
    }
    function openSupport(){ switchTab("support"); }

    function switchMyTab(t){
      state.myTab = t;
      document.getElementById("tab-pass").classList.toggle("active", t==="pass");
      document.getElementById("tab-voucher").classList.toggle("active", t==="voucher");
      document.getElementById("tab-history").classList.toggle("active", t==="history");

      document.getElementById("my-pass").style.display = (t==="pass") ? "block" : "none";
      document.getElementById("my-voucher").style.display = (t==="voucher") ? "block" : "none";
      document.getElementById("my-history").style.display = (t==="history") ? "block" : "none";
      feather.replace();
    }

    /* MY render */
    function renderMy(){
      const nameEl = document.getElementById("profileName");
      const imgEl = document.getElementById("profileImg");
      const textEl = document.getElementById("myPassText");

      if(!state.loggedIn){
        nameEl.innerText = "Guest";
        imgEl.src = "";
        textEl.innerText = "ë¡œê·¸ì¸í•˜ë©´ ë‚´ íŒ¨ìŠ¤/QRì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.";
        document.getElementById("passStatus").innerHTML = `<span class="dot inactive"></span><span>INACTIVE</span>`;
        document.getElementById("remainText").innerText = "-";
        document.getElementById("partnerCount").innerText = partners.length + "ê³³(ì‹œì—°)";
        renderVoucherDemo(false);
        renderHistoryDemo(false);
        return;
      }

      nameEl.innerText = state.user?.name || "User";
      imgEl.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(state.user?.name || "BPASS")}`;

      if(state.pass && state.pass.status==="ACTIVE"){
        textEl.innerText = `íŒ¨ìŠ¤ ACTIVE Â· ë‚¨ì€ ì‹œê°„ ${fmtRemain(state.pass.end_at)}`;
        document.getElementById("passStatus").innerHTML = `<span class="dot active"></span><span>ACTIVE</span>`;
        document.getElementById("remainText").innerText = fmtRemain(state.pass.end_at);
      } else {
        textEl.innerText = "íŒ¨ìŠ¤ ì—†ìŒ Â· êµ¬ë§¤ í›„ QR ì‚¬ìš©";
        document.getElementById("passStatus").innerHTML = `<span class="dot inactive"></span><span>INACTIVE</span>`;
        document.getElementById("remainText").innerText = "-";
      }
      document.getElementById("partnerCount").innerText = partners.length + "ê³³(ì‹œì—°)";

      renderVoucherDemo(true);
      renderHistoryDemo(true);
    }

    function renderVoucherDemo(logged){
      const list = document.getElementById("voucherList");
      list.innerHTML = "";

      const items = logged ? [
        { title:"ì¹´í˜ 10% í• ì¸", code:"VCH-COFFEE-1031", used:false, type:"normal" },
        { title:"íƒì‹œ ì´ìš©ê¶Œ(ì¿ í° ì§€ê¸‰í˜•)", code:"TAXI-COUPON-8310", used:false, type:"taxi" }
      ] : [
        { title:"(ë¡œê·¸ì¸ í›„ í™•ì¸)", code:"-", used:false, type:"normal" }
      ];

      items.forEach(x=>{
        const row = document.createElement("div");
        row.className="list-row";
        row.innerHTML = `
          <div style="display:flex;flex-direction:column;gap:4px;">
            <div>${x.title}</div>
            <div style="font-size:12px;color:var(--sub);font-weight:900;">${x.code}</div>
          </div>
          <div style="font-size:12px;font-weight:950;color:${x.used ? "#9CA3AF" : "#10B981"};">
            ${x.used ? "ì‚¬ìš©ì™„ë£Œ" : "ì‚¬ìš©ê°€ëŠ¥"}
          </div>
        `;
        row.onclick = ()=>{
          if(!logged){ checkLogin(); return; }
          if(x.type==="taxi"){
            alert("íƒì‹œ ì´ìš©ê¶Œì€ ì¿ í°ë²ˆí˜¸ë¥¼ íƒì‹œ ì•±/ì œíœ´ ì±„ë„ì— ì…ë ¥í•´ ì‚¬ìš©í•©ë‹ˆë‹¤(ì‹œì—°ìš©).");
          }else{
            alert("ë°”ìš°ì²˜ ìƒì„¸(ì‹œì—°ìš©)");
          }
        };
        list.appendChild(row);
      });
      feather.replace();
    }

    function renderHistoryDemo(logged){
      const list = document.getElementById("historyList");
      list.innerHTML = "";

      const items = logged ? [
        { title:"Coffee Partner", time:"2026-01-08 10:20", detail:"íŒ¨ìŠ¤ 10% í• ì¸ ì ìš©(ì‹œì—°)" },
        { title:"WeWork Partner Space", time:"2026-01-07 14:10", detail:"ë°ì´íŒ¨ìŠ¤ 10% í• ì¸(ì‹œì—°)" },
      ] : [
        { title:"(ë¡œê·¸ì¸ í›„ í™•ì¸)", time:"-", detail:"-" }
      ];

      items.forEach(x=>{
        const row = document.createElement("div");
        row.className="list-row";
        row.innerHTML = `
          <div style="display:flex;flex-direction:column;gap:4px;">
            <div>${x.title}</div>
            <div style="font-size:12px;color:var(--sub);font-weight:900;">${x.time} Â· ${x.detail}</div>
          </div>
          <i data-feather="chevron-right" style="color:#c7c7c7;"></i>
        `;
        row.onclick = ()=>{ if(!logged) checkLogin(); else alert("ì´ìš©ë‚´ì—­ ìƒì„¸(ì‹œì—°ìš©)"); };
        list.appendChild(row);
      });
      feather.replace();
    }

    /* =========================
       PART 2ì—ì„œ ì´ì–´ì§
    ========================= */
  </script>
</body>
</html>
<!-- =========================
  PART 1 / 2 ë
========================= -->
<!-- =========================
  PART 2 / 2
  (ì´ ì½”ë“œë¥¼ PART1ì˜ <script> ëë¶€ë¶„ "/* PART 2ì—ì„œ ì´ì–´ì§ */" ì•„ë˜ì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê¸°)
========================= -->

<script>
  /* =========================
     ì§€ë„(Map)
  ========================= */
  function initMap(){
    if(map) { setTimeout(()=>map.invalidateSize(), 50); return; }

    map = L.map('map', { zoomControl:false }).setView([35.1601, 129.0609], 12);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    renderMapFilters();
    renderMarkers();
    setTimeout(()=>map.invalidateSize(), 50);
  }

  function renderMapFilters(){
    const el = document.getElementById("mapFilters");
    el.innerHTML = "";
    CATS.forEach(c=>{
      const chip = document.createElement("div");
      chip.className = "chip" + (c.id===currentFilter ? " active" : "");
      chip.innerText = c.label;
      chip.onclick = ()=>{ setFilter(c.id); };
      el.appendChild(chip);
    });
  }

  function setFilter(cat){
    currentFilter = cat;
    renderMapFilters();
    renderMarkers();
  }

  function renderMarkers(){
    if(!map) return;

    markers.forEach(m=>map.removeLayer(m));
    markers = [];

    const list = partners.filter(p=>{
      if(currentFilter==="all") return true;
      return p.cat === currentFilter;
    });

    list.forEach(p=>{
      const m = L.marker(p.coords).addTo(map);
      m.on("click", ()=>openPartnerSheet(p.id));
      markers.push(m);
    });
  }

  function focusPartner(pid){
    const p = partners.find(x=>x.id===pid);
    if(!p){ return; }
    initMap();
    setFilter("all");
    map.setView(p.coords, 15, { animate:true });
    setTimeout(()=>openPartnerSheet(pid), 120);
  }

  function openPartnerSheet(pid){
    const p = partners.find(x=>x.id===pid);
    if(!p) return;
    lastOpenedPartner = p;

    document.getElementById("psName").innerText = p.name;
    document.getElementById("psMeta").innerText = `${catLabel(p.cat)} Â· ${p.hours}`;
    document.getElementById("psDesc").innerText = p.desc;

    const b = document.getElementById("psBenefit");
    b.innerHTML = `<i data-feather="percent" style="width:14px;"></i> ${p.benefit}`;

    currentPartnerIdForDirections = p.id;

    document.getElementById("placeSheet").style.display = "flex";
    feather.replace();
  }

  function hidePlaceSheet(){
    document.getElementById("placeSheet").style.display = "none";
  }
  function closePlaceSheet(e){
    if(e.target.id === "placeSheet") hidePlaceSheet();
  }

  function openDirections(){
    if(!currentPartnerIdForDirections) return;
    const p = partners.find(x=>x.id===currentPartnerIdForDirections);
    if(!p) return;

    // êµ¬ê¸€ì§€ë„ ê¸¸ì°¾ê¸°(ì¢Œí‘œ)
    const [lat, lng] = p.coords;
    const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
    window.open(url, "_blank");
  }

  /* =========================
     ë‚´ ì£¼ë³€ / ê²€ìƒ‰
  ========================= */
  function goNearMe(){
    if(!map) initMap();
    if(!navigator.geolocation){
      alert("ì´ ê¸°ê¸°ì—ì„œ ìœ„ì¹˜ ì‚¬ìš©ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      return;
    }
    navigator.geolocation.getCurrentPosition((pos)=>{
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;

      if(myMarker) map.removeLayer(myMarker);
      myMarker = L.marker([lat,lng]).addTo(map);

      map.setView([lat,lng], 14, { animate:true });
    }, ()=>{
      alert("ìœ„ì¹˜ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
    }, { enableHighAccuracy:true, timeout:8000 });
  }

  function toggleMapSearch(open){
    const bar = document.getElementById("mapSearchBar");
    const view = document.getElementById("view-map");

    if(open){
      bar.classList.add("open");
      view.classList.add("map-search-open");
      setTimeout(()=>document.getElementById("mapSearchInput").focus(), 50);
    }else{
      bar.classList.remove("open");
      view.classList.remove("map-search-open");
      document.getElementById("mapSearchInput").value = "";
    }
    setTimeout(()=>{ if(map) map.invalidateSize(); }, 50);
  }

  function runMapSearch(){
    const q = (document.getElementById("mapSearchInput").value || "").trim().toLowerCase();
    if(!q){ alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }

    const found = partners.find(p => p.name.toLowerCase().includes(q));
    if(!found){ alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

    map.setView(found.coords, 15, { animate:true });
    openPartnerSheet(found.id);
  }

  function filterMapAndGo(cat){
    switchTab("map");
    setTimeout(()=>{
      initMap();
      setFilter(cat);
    }, 50);
  }

  /* =========================
     FAQ
  ========================= */
  function toggleFaq(card){
    const body = card.querySelector(".muted");
    if(!body) return;
    body.style.display = (body.style.display==="none" || !body.style.display) ? "block" : "none";
    feather.replace();
  }

  /* =========================
     ì–¸ì–´
  ========================= */
  function openLang(){ openModal("langModal"); }
  function selectLang(code){
    const text = document.getElementById("langText");
    if(code==="kr") text.innerText="KR";
    if(code==="en") text.innerText="EN";
    if(code==="cn") text.innerText="CN";
    if(code==="jp") text.innerText="JP";
    closeModal("langModal");
  }

  /* =========================
     ì•½ê´€/ì •ì±…
  ========================= */
  function openLegal(type){
    const t = document.getElementById("legalTitle");
    const b = document.getElementById("legalBody");

    if(type==="terms"){
      t.innerText = "ì´ìš©ì•½ê´€(ìš”ì•½)";
      b.innerText =
`[ì‹œì—°ìš© ì•½ê´€ ìš”ì•½]
- BÂ·PASS Livingì€ ì²´ë¥˜í˜• íŒ¨ìŠ¤ ì„œë¹„ìŠ¤(í”„ë¡œí† íƒ€ì…)ì…ë‹ˆë‹¤.
- ì œíœ´ì²˜ í˜œíƒ/ìš´ì˜ì‹œê°„ì€ ì‹¤ì œ ìš´ì˜ ì‹œ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë¶€ì • ì‚¬ìš© ë°©ì§€ë¥¼ ìœ„í•´ QR ì¸ì¦ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.`;
    }else if(type==="privacy"){
      t.innerText = "ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨(ìš”ì•½)";
      b.innerText =
`[ì‹œì—°ìš© ê°œì¸ì •ë³´ ìš”ì•½]
- ë¡œê·¸ì¸ ì‹œ í”„ë¡œí•„ ì‹ë³„ ì •ë³´(ë‹‰ë„¤ì„/ID)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ê²°ì œ ì²˜ë¦¬ ë° ê³ ê°ì§€ì› ëª©ì  ë²”ìœ„ ë‚´ì—ì„œë§Œ í™œìš©í•©ë‹ˆë‹¤.
- ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ ì‹œ ë³„ë„ ë™ì˜ ë° ë³´ê´€ ê¸°ê°„ì„ ëª…ì‹œí•©ë‹ˆë‹¤.`;
    }else if(type==="refund"){
      t.innerText = "í™˜ë¶ˆ/ì·¨ì†Œ ì •ì±…(ìš”ì•½)";
      b.innerText =
`[ì‹œì—°ìš© í™˜ë¶ˆ/ì·¨ì†Œ ìš”ì•½]
- ì‚¬ìš© ì „: ê²°ì œ ì·¨ì†Œ ê°€ëŠ¥(ìˆ˜ìˆ˜ë£Œ ì •ì±…ì€ ê²°ì œ ìˆ˜ë‹¨ì— ë”°ë¦„)
- ì‚¬ìš© í›„: ì´ìš© ë‚´ì—­/í˜œíƒ ì ìš© ì—¬ë¶€ì— ë”°ë¼ í™˜ë¶ˆ ê¸ˆì•¡ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ
- ìì„¸í•œ ì •ì±…ì€ ì‹¤ì œ ìš´ì˜ ì‹œ ê³ ì§€ë©ë‹ˆë‹¤.`;
    }else{
      t.innerText = "ì•ˆë‚´";
      b.innerText = "ì •ì±… ë¬¸ì„œ(ì‹œì—°ìš©)";
    }
    openModal("legalModal");
  }

  /* =========================
     íƒì‹œ ì´ìš©ê¶Œ ì•ˆë‚´
  ========================= */
  function openTaxiBiz(){
    window.open(TAXI_BIZ_URL, "_blank");
  }

  /* ==========================================================
     âœ… ì¶”ì²œ(â­) ëª¨ë‹¬ ê¸°ëŠ¥
     - HOMEì˜ ì¶”ì²œì¹´ë“œëŠ” ì£¼ì„ìœ¼ë¡œ ë³´ê´€í–ˆê³ 
     - í•˜ë‹¨ ë„¤ë¹„ì˜ â­ë¥¼ ëˆ„ë¥´ë©´ ì´ ëª¨ë‹¬ì´ ì—´ë¦¼
     - íƒ­ì„ ëˆ„ë¥´ë©´ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ê°€ í‘œì‹œë¨
  ========================================================== */
  function openRecommendModal(){
    // ê¸°ë³¸ íƒ­ ìƒíƒœ ìœ ì§€í•˜ë©´ì„œ ì˜¤í”ˆ
    openModal("recommendModal");
    setRecommendCat(state.recommendCat || "stay", false);
  }

  function setRecommendCat(cat, rerender){
    state.recommendCat = cat;

    // íƒ­ active ì²˜ë¦¬
    const mapTab = {
      stay:"rm-stay",
      food:"rm-cafe",
      restaurant:"rm-restaurant",
      office:"rm-office"
    };
    Object.values(mapTab).forEach(id=>{
      const el = document.getElementById(id);
      if(el) el.classList.remove("active");
    });
    const activeId = mapTab[cat];
    if(activeId) document.getElementById(activeId).classList.add("active");

    // íƒ€ì´í‹€/ì„¤ëª… ë³€ê²½
    const title = document.getElementById("recModalTitle");
    const desc  = document.getElementById("recModalDesc");

    if(cat==="stay"){
      title.innerText = "ì¶”ì²œ Â· ìˆ™ì†Œ";
      desc.innerText  = "ë¶€ì‚° ì£¼ìš” ê±°ì (ë²¡ìŠ¤ì½”/ë¶€ì‚°í•­/í•´ìš´ëŒ€/ì„œë©´) ì¸ê·¼ ì¶”ì²œ ìˆ™ì†Œë¥¼ í™•ì¸í•˜ì„¸ìš”. (ì‹œì—°ìš©)";
    }else if(cat==="food"){
      title.innerText = "ì¶”ì²œ Â· ì¹´í˜";
      desc.innerText  = "ì—…ë¬´/ë¯¸íŒ… ë™ì„ ì— ë§ì¶˜ ì¹´í˜ ì¶”ì²œì„ í™•ì¸í•˜ì„¸ìš”. (ì‹œì—°ìš©)";
    }else if(cat==="restaurant"){
      title.innerText = "ì¶”ì²œ Â· ìŒì‹ì ";
      desc.innerText  = "ì§€ì—­ ê±°ì ë³„ ìŒì‹ì  ì¶”ì²œì„ í™•ì¸í•˜ì„¸ìš”. (ì‹œì—°ìš©)";
    }else if(cat==="office"){
      title.innerText = "ì¶”ì²œ Â· ê³µìœ ì˜¤í”¼ìŠ¤";
      desc.innerText  = "í–‰ì‚¬/ë¯¸íŒ…ì„ ìœ„í•œ ê³µìœ ì˜¤í”¼ìŠ¤ ì¶”ì²œì„ í™•ì¸í•˜ì„¸ìš”. (ì‹œì—°ìš©)";
    }

    if(rerender) renderRecommendModal();
  }

  function renderRecommendModal(){
    const listEl = document.getElementById("recModalList");
    if(!listEl) return;

    // ëª¨ë‹¬ì—ì„œ ë³´ì—¬ì¤„ ì¶”ì²œ í•­ëª©ì€ partnersì—ì„œ cat ê¸°ì¤€ìœ¼ë¡œ ë½‘ìŒ
    const cat = state.recommendCat || "stay";
    const items = partners.filter(p => p.cat === cat);

    listEl.innerHTML = "";

    if(items.length===0){
      const empty = document.createElement("div");
      empty.className = "rec-item";
      empty.innerHTML = `
        <div class="rec-title">ì¶”ì²œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>
        <div class="rec-meta">í˜„ì¬ ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      `;
      listEl.appendChild(empty);
      return;
    }

    items.forEach(p=>{
      const div = document.createElement("div");
      div.className = "rec-item";
      div.innerHTML = `
        <div class="rec-title">${p.name}</div>
        <div class="rec-meta">${p.benefit} Â· ${p.hours}</div>
        <div class="rec-actions">
          <div class="pill ghost" onclick="switchTab('map'); closeModal('recommendModal'); focusPartner('${p.id}')">
            <i data-feather="map-pin" style="width:14px;"></i> ì§€ë„ì—ì„œ ë³´ê¸°
          </div>
          <div class="pill ghost" onclick="closeModal('recommendModal'); openPartnerSheet('${p.id}')">
            <i data-feather="info" style="width:14px;"></i> ìƒì„¸
          </div>
        </div>
      `;
      listEl.appendChild(div);
    });

    feather.replace();
  }

  /* =========================
     ì´ˆê¸° ë¡œë”©
  ========================= */
  (function boot(){
    renderCarousel();
    loadMe();

    // ì˜¨ë³´ë”© 1íšŒ
    const done = localStorage.getItem("bpass_onboarding_done");
    if(!done) showOnboarding();
  })();

  /* ==========================================================
   [ì¶”ê°€] âœ… ëª¨ë‹¬ì´ í•­ìƒ "ë§ˆì§€ë§‰ìœ¼ë¡œ ì—° ê²ƒ"ì´ ìœ„ë¡œ ì˜¤ê²Œ (z-index ìŠ¤íƒ)
   - êµ¬ë§¤í•˜ê¸° ì°½ ìœ„ì— ë¡œê·¸ì¸ ì°½ì´ ë°”ë¡œ ì˜¬ë¼ì˜¤ê²Œ í•´ê²°
========================================================== */
let __modalZ = 20000;

(function patchModalStacking(){
  const _openModal = window.openModal;
  const _closeModal = window.closeModal;

  // openModalì´ ì¡´ì¬í•  ë•Œë§Œ íŒ¨ì¹˜
  if(typeof _openModal === "function"){
    window.openModal = function(id){
      const el = document.getElementById(id);
      if(!el) return;
      // display ë¨¼ì €
      el.style.display = "flex";
      // í•­ìƒ ìµœì‹  ëª¨ë‹¬ì´ ìœ„ë¡œ ì˜¤ë„ë¡ z-index ì¦ê°€
      __modalZ += 10;
      el.style.zIndex = String(__modalZ);
      // ì•„ì´ì½˜ ê°±ì‹ 
      feather.replace();
    };
  }

  // closeModalì€ ê·¸ëŒ€ë¡œ ì‚¬ìš© (í˜¹ì‹œ ì—†ìœ¼ë©´ ì•ˆì „ ì²˜ë¦¬)
  if(typeof _closeModal !== "function"){
    window.closeModal = function(id){
      const el = document.getElementById(id);
      if(el) el.style.display="none";
    };
  }
})();

/* ==========================================================
   [ì¶”ê°€] âœ… ëª¨ë‹¬ ë°”ê¹¥(ì˜¤ë²„ë ˆì´) í´ë¦­ ì‹œ ë‹«ê¸°
   - êµ¬ë§¤í•˜ê¸°(passDetail/payment) / ì¶”ì²œ(recommend) í¬í•¨
========================================================== */
(function enableOverlayOutsideClose(){
  const closableOverlays = [
    "passDetailModal",
    "paymentSheet",
    "recommendModal",
    "legalModal",
    "langModal",
    "loginModal",
    "qrModal"
  ];

  closableOverlays.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;

    // ì´ë¯¸ í•¸ë“¤ëŸ¬ê°€ ìˆë‹¤ë©´ ì¤‘ë³µ ë“±ë¡ ë°©ì§€
    if(el.__outsideCloseBound) return;
    el.__outsideCloseBound = true;

    el.addEventListener("click", (e)=>{
      // ì˜¤ë²„ë ˆì´(ë°°ê²½) ìì²´ë¥¼ í´ë¦­í•œ ê²½ìš°ë§Œ ë‹«ê¸°
      if(e.target === el){
        closeModal(id);
      }
    });
  });
})();

/* ==========================================================
   [ì¶”ê°€] âœ… êµ¬ë§¤í•˜ê¸° ëˆŒë €ì„ ë•Œ ë¡œê·¸ì¸ ì°½ì´ "ì¦‰ì‹œ" ìœ„ë¡œ ëœ¨ê²Œ í™•ì‹¤íˆ ë³´ì¥
   - openPaymentì—ì„œ checkLogin()ì„ í˜¸ì¶œí•´ë„, passDetailModal ìœ„ë¡œ ì˜¬ë¼ì™€ì•¼ í•¨
   - ìœ„ì˜ z-index ìŠ¤íƒì´ í•µì‹¬ í•´ê²°
   - í˜¹ì‹œ ê¸°ì¡´ checkLoginì´ openModal('loginModal')ë§Œ í•œë‹¤ë©´ ê·¸ëŒ€ë¡œ OK
========================================================== */
(function forceLoginOnTop(){
  const _checkLogin = window.checkLogin;
  if(typeof _checkLogin === "function"){
    window.checkLogin = function(){
      // ê¸°ì¡´ ë¡œì§ ìˆ˜í–‰
      _checkLogin();
      // í˜¹ì‹œ displayë§Œ ë˜ê³  z-indexê°€ ë‚®ìœ¼ë©´, ê°•ì œë¡œ ìµœìƒë‹¨ ì˜¬ë¦¼
      const lm = document.getElementById("loginModal");
      if(lm && lm.style.display !== "none"){
        __modalZ += 10;
        lm.style.zIndex = String(__modalZ);
      }
      feather.replace();
    };
  }
})();

</script>

<!-- =========================
  PART 2 / 2 ë
========================= -->
